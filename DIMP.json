[
{
  "model": "desktop.document2",
  "pk": 165162,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "DIMP: 1 Criar Tbls",
    "description": "",
    "uuid": "53ab7c52-fa57-f226-0d9b-11be166ae901",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 165162, \"uuid\": \"53ab7c52-fa57-f226-0d9b-11be166ae901\", \"name\": \"DIMP: 1 Criar Tbls\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"53ab7c52-fa57-f226-0d9b-11be166ae901\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"9e6d39a4-d4f2-2427-bc7a-e7c581d660c0\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 373, \"column\": 43}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": false, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"usr_sat_admcc\", \"currentQueryTab\": \"savedQueries\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ========================================================================\\r\\n-- PROJETO DIMP - AN\\u00c1LISE DE MEIOS DE PAGAMENTO\\r\\n-- Objetivo: Investigar empresas que recebem pagamentos via CPF de s\\u00f3cios\\r\\n-- Database: teste.dimp_*\\r\\n-- Per\\u00edodo: 2024-2025 (ajustar conforme necess\\u00e1rio)\\r\\n-- ========================================================================\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 1: Tabela Base - CNPJs Ativos para An\\u00e1lise\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_cnpj_base;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_cnpj_base AS\\r\\nSELECT DISTINCT\\r\\n    e.nu_cnpj AS cnpj,\\r\\n    e.nm_razao_social,\\r\\n    e.nm_fantasia,\\r\\n    e.nm_sit_cadastral,\\r\\n    e.dt_sit_cadastral,\\r\\n    e.nm_reg_apuracao AS regime_tributario,\\r\\n    e.cd_cnae1,\\r\\n    e.nm_cnae1,\\r\\n    e.nm_munic AS municipio,\\r\\n    e.cd_uf AS uf,\\r\\n    e.dt_inicio_icms,\\r\\n    e.dt_constituicao_empresa,\\r\\n    e.nu_telefone,\\r\\n    e.nm_email\\r\\nFROM usr_sat_ods.vw_cad_contrib e\\r\\nWHERE e.nm_sit_cadastral IN ('ATIVA', 'ATIVO')\\r\\n    AND e.dt_inicio_icms IS NOT NULL;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 2: Tabela de S\\u00f3cios Ativos\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_socios;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_socios AS\\r\\nSELECT \\r\\n    REGEXP_REPLACE(TRIM(v.nu_cnpj_princ), '[^0-9]', '') AS cnpj,\\r\\n    REGEXP_REPLACE(TRIM(v.nu_cnpj_cpf_secund), '[^0-9]', '') AS cpf_socio,\\r\\n    v.nm_relacao,\\r\\n    v.nm_qualificacao,\\r\\n    v.dt_inicio_relacao,\\r\\n    v.dt_fim_relacao,\\r\\n    v.pe_capital_empresa AS perc_participacao,\\r\\n    v.sn_relacao_ativa,\\r\\n    pf.nm_pessoa AS nome_socio,\\r\\n    pf.nm_munic AS municipio_socio,\\r\\n    pf.nu_telefone AS telefone_socio,\\r\\n    bc.dtnasc AS data_nascimento,\\r\\n    bc.nomemae AS nome_mae\\r\\nFROM usr_sat_ods.vw_cad_vinculo v\\r\\nLEFT JOIN usr_sat_ods.cad_pessoa_fisica_raw pf \\r\\n    ON REGEXP_REPLACE(TRIM(v.nu_cnpj_cpf_secund), '[^0-9]', '') = REGEXP_REPLACE(TRIM(pf.nu_cpf), '[^0-9]', '')\\r\\nLEFT JOIN bcadastro.cpf bc \\r\\n    ON REGEXP_REPLACE(TRIM(pf.nu_cpf), '[^0-9]', '') = REGEXP_REPLACE(TRIM(bc.cpfid), '[^0-9]', '')\\r\\nWHERE v.nm_relacao NOT IN ('CONTABILISTA')\\r\\n    AND v.sn_relacao_ativa = 1\\r\\n    AND LENGTH(REGEXP_REPLACE(TRIM(v.nu_cnpj_cpf_secund), '[^0-9]', '')) = 11;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 3: Pagamentos Recebidos por CNPJ (Empresa)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_pagamentos_cnpj;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_pagamentos_cnpj AS\\r\\nSELECT\\r\\n    c.cnpj,\\r\\n    c.nm_razao_social,\\r\\n    c.regime_tributario,\\r\\n    p.ato_dt_referencia AS referencia,\\r\\n    p.ato_vl_credito AS vl_credito,\\r\\n    p.ato_vl_debito AS vl_debito,\\r\\n    p.ato_vl_pix AS vl_pix,\\r\\n    p.ato_vl_boleto AS vl_boleto,\\r\\n    p.ato_vl_transferencia AS vl_transferencia,\\r\\n    p.ato_vl_dinheiro AS vl_dinheiro,\\r\\n    p.ato_vl_voucher AS vl_voucher,\\r\\n    p.ato_vl_outros AS vl_outros,\\r\\n    (p.ato_vl_credito + p.ato_vl_debito + p.ato_vl_pix + \\r\\n     COALESCE(p.ato_vl_boleto, 0) + COALESCE(p.ato_vl_transferencia, 0) + \\r\\n     COALESCE(p.ato_vl_dinheiro, 0) + COALESCE(p.ato_vl_voucher, 0) + \\r\\n     COALESCE(p.ato_vl_outros, 0)) AS vl_total\\r\\nFROM teste.dimp_cnpj_base c\\r\\nINNER JOIN usr_sat_admcc.acc_r66_totalestab p \\r\\n    ON c.cnpj = p.ato_nu_cnpjmf\\r\\nWHERE p.ato_dt_referencia BETWEEN 202401 AND 202509\\r\\n    AND LENGTH(TRIM(p.ato_nu_cnpjmf)) = 14;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 4: Pagamentos Recebidos por CPF (S\\u00f3cios)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_pagamentos_cpf;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_pagamentos_cpf AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.cpf_socio,\\r\\n    s.nome_socio,\\r\\n    s.nm_qualificacao,\\r\\n    s.perc_participacao,\\r\\n    p.ato_dt_referencia AS referencia,\\r\\n    p.ato_vl_credito AS vl_credito,\\r\\n    p.ato_vl_debito AS vl_debito,\\r\\n    p.ato_vl_pix AS vl_pix,\\r\\n    p.ato_vl_boleto AS vl_boleto,\\r\\n    p.ato_vl_transferencia AS vl_transferencia,\\r\\n    p.ato_vl_dinheiro AS vl_dinheiro,\\r\\n    p.ato_vl_voucher AS vl_voucher,\\r\\n    p.ato_vl_outros AS vl_outros,\\r\\n    (p.ato_vl_credito + p.ato_vl_debito + p.ato_vl_pix + \\r\\n     COALESCE(p.ato_vl_boleto, 0) + COALESCE(p.ato_vl_transferencia, 0) + \\r\\n     COALESCE(p.ato_vl_dinheiro, 0) + COALESCE(p.ato_vl_voucher, 0) + \\r\\n     COALESCE(p.ato_vl_outros, 0)) AS vl_total\\r\\nFROM teste.dimp_socios s\\r\\nINNER JOIN usr_sat_admcc.acc_r66_totalestab p \\r\\n    ON s.cpf_socio = TRIM(p.ato_nu_cnpjmf)\\r\\nWHERE p.ato_dt_referencia BETWEEN 202401 AND 202509\\r\\n    AND LENGTH(TRIM(p.ato_nu_cnpjmf)) = 11;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 5: Tabela Consolidada - Compara\\u00e7\\u00e3o CNPJ vs CPF\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_comparacao_cnpj_cpf;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_comparacao_cnpj_cpf AS\\r\\nWITH\\r\\n-- Agrega\\u00e7\\u00e3o por empresa (CNPJ)\\r\\npagto_cnpj AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT referencia) AS meses_com_pagto_cnpj,\\r\\n        SUM(vl_total) AS total_cnpj,\\r\\n        SUM(vl_credito) AS total_credito_cnpj,\\r\\n        SUM(vl_debito) AS total_debito_cnpj,\\r\\n        SUM(vl_pix) AS total_pix_cnpj,\\r\\n        AVG(vl_total) AS media_mensal_cnpj\\r\\n    FROM teste.dimp_pagamentos_cnpj\\r\\n    GROUP BY cnpj\\r\\n),\\r\\n-- Agrega\\u00e7\\u00e3o por empresa (via CPF dos s\\u00f3cios)\\r\\npagto_cpf AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT cpf_socio) AS qtd_socios_recebendo,\\r\\n        COUNT(DISTINCT referencia) AS meses_com_pagto_cpf,\\r\\n        SUM(vl_total) AS total_cpf,\\r\\n        SUM(vl_credito) AS total_credito_cpf,\\r\\n        SUM(vl_debito) AS total_debito_cpf,\\r\\n        SUM(vl_pix) AS total_pix_cpf,\\r\\n        AVG(vl_total) AS media_mensal_cpf\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cnpj\\r\\n)\\r\\nSELECT\\r\\n    c.cnpj,\\r\\n    c.nm_razao_social,\\r\\n    c.regime_tributario,\\r\\n    c.municipio,\\r\\n    c.uf,\\r\\n    c.cd_cnae1,\\r\\n    c.nm_cnae1,\\r\\n    COALESCE(pc.total_cnpj, 0) AS total_recebido_cnpj,\\r\\n    COALESCE(pf.total_cpf, 0) AS total_recebido_cpf,\\r\\n    COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) AS total_geral,\\r\\n    COALESCE(pf.qtd_socios_recebendo, 0) AS qtd_socios_recebendo,\\r\\n    COALESCE(pc.meses_com_pagto_cnpj, 0) AS meses_com_pagto_cnpj,\\r\\n    COALESCE(pf.meses_com_pagto_cpf, 0) AS meses_com_pagto_cpf,\\r\\n    -- Percentuais\\r\\n    CASE \\r\\n        WHEN COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0 \\r\\n        THEN ROUND(COALESCE(pf.total_cpf, 0) * 100.0 / \\r\\n             (COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0)), 2)\\r\\n        ELSE 0 \\r\\n    END AS perc_recebido_cpf,\\r\\n    CASE \\r\\n        WHEN COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0 \\r\\n        THEN ROUND(COALESCE(pc.total_cnpj, 0) * 100.0 / \\r\\n             (COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0)), 2)\\r\\n        ELSE 0 \\r\\n    END AS perc_recebido_cnpj,\\r\\n    -- Detalhamento por tipo de pagamento\\r\\n    COALESCE(pc.total_pix_cnpj, 0) AS pix_cnpj,\\r\\n    COALESCE(pf.total_pix_cpf, 0) AS pix_cpf,\\r\\n    COALESCE(pc.total_credito_cnpj, 0) AS credito_cnpj,\\r\\n    COALESCE(pf.total_credito_cpf, 0) AS credito_cpf,\\r\\n    COALESCE(pc.total_debito_cnpj, 0) AS debito_cnpj,\\r\\n    COALESCE(pf.total_debito_cpf, 0) AS debito_cpf\\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN pagto_cnpj pc ON c.cnpj = pc.cnpj\\r\\nLEFT JOIN pagto_cpf pf ON c.cnpj = pf.cnpj\\r\\nWHERE COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 6: Tabela de M\\u00e9tricas e Scores de Risco\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_metricas_risco;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_metricas_risco AS\\r\\nWITH\\r\\n-- Estat\\u00edsticas por regime tribut\\u00e1rio\\r\\npercentis_regime AS (\\r\\n    SELECT\\r\\n        regime_tributario,\\r\\n        perc_recebido_cpf,\\r\\n        PERCENT_RANK() OVER (PARTITION BY regime_tributario ORDER BY perc_recebido_cpf) AS percentil_rank\\r\\n    FROM teste.dimp_comparacao_cnpj_cpf\\r\\n),\\r\\nestatisticas_regime AS (\\r\\n    SELECT\\r\\n        regime_tributario,\\r\\n        AVG(perc_recebido_cpf) AS media_perc_cpf_regime,\\r\\n        STDDEV(perc_recebido_cpf) AS desvio_perc_cpf_regime,\\r\\n        MAX(CASE WHEN percentil_rank >= 0.75 THEN perc_recebido_cpf ELSE NULL END) AS percentil_75_cpf\\r\\n    FROM percentis_regime\\r\\n    GROUP BY regime_tributario\\r\\n)\\r\\nSELECT\\r\\n    c.*,\\r\\n    e.media_perc_cpf_regime,\\r\\n    e.desvio_perc_cpf_regime,\\r\\n    e.percentil_75_cpf,\\r\\n    -- Score 1: Propor\\u00e7\\u00e3o CPF vs CNPJ (0-100)\\r\\n    CASE \\r\\n        WHEN c.perc_recebido_cpf >= 80 THEN 100\\r\\n        WHEN c.perc_recebido_cpf >= 60 THEN 80\\r\\n        WHEN c.perc_recebido_cpf >= 40 THEN 60\\r\\n        WHEN c.perc_recebido_cpf >= 20 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_proporcao,\\r\\n    -- Score 2: Volume absoluto recebido em CPF (0-100)\\r\\n    CASE \\r\\n        WHEN c.total_recebido_cpf >= 1000000 THEN 100\\r\\n        WHEN c.total_recebido_cpf >= 500000 THEN 80\\r\\n        WHEN c.total_recebido_cpf >= 100000 THEN 60\\r\\n        WHEN c.total_recebido_cpf >= 50000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_volume_cpf,\\r\\n    -- Score 3: Quantidade de s\\u00f3cios recebendo (0-100)\\r\\n    CASE \\r\\n        WHEN c.qtd_socios_recebendo >= 5 THEN 100\\r\\n        WHEN c.qtd_socios_recebendo >= 3 THEN 80\\r\\n        WHEN c.qtd_socios_recebendo >= 2 THEN 60\\r\\n        WHEN c.qtd_socios_recebendo >= 1 THEN 40\\r\\n        ELSE 0\\r\\n    END AS score_qtd_socios,\\r\\n    -- Score 4: Desvio em rela\\u00e7\\u00e3o ao regime tribut\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN e.desvio_perc_cpf_regime > 0 AND \\r\\n             c.perc_recebido_cpf > e.media_perc_cpf_regime + (2 * e.desvio_perc_cpf_regime) \\r\\n        THEN 100\\r\\n        WHEN e.desvio_perc_cpf_regime > 0 AND \\r\\n             c.perc_recebido_cpf > e.media_perc_cpf_regime + e.desvio_perc_cpf_regime \\r\\n        THEN 70\\r\\n        WHEN c.perc_recebido_cpf > e.percentil_75_cpf \\r\\n        THEN 50\\r\\n        ELSE 25\\r\\n    END AS score_desvio_regime,\\r\\n    -- Score 5: Consist\\u00eancia temporal (recebe em CPF todo m\\u00eas) (0-100)\\r\\n    CASE \\r\\n        WHEN c.meses_com_pagto_cpf >= 9 THEN 100\\r\\n        WHEN c.meses_com_pagto_cpf >= 6 THEN 70\\r\\n        WHEN c.meses_com_pagto_cpf >= 3 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_consistencia\\r\\nFROM teste.dimp_comparacao_cnpj_cpf c\\r\\nLEFT JOIN estatisticas_regime e ON c.regime_tributario = e.regime_tributario;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 7: Score Final de Risco\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_score_final;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_score_final AS\\r\\nSELECT\\r\\n    m.*,\\r\\n    -- Score Final (m\\u00e9dia ponderada)\\r\\n    ROUND(\\r\\n        (m.score_proporcao * 0.30) + \\r\\n        (m.score_volume_cpf * 0.25) + \\r\\n        (m.score_qtd_socios * 0.15) + \\r\\n        (m.score_desvio_regime * 0.20) + \\r\\n        (m.score_consistencia * 0.10),\\r\\n    2) AS score_risco_final,\\r\\n    -- Classifica\\u00e7\\u00e3o de Risco\\r\\n    CASE \\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 80 THEN 'ALTO'\\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 60 THEN 'M\\u00c9DIO-ALTO'\\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco\\r\\nFROM teste.dimp_metricas_risco m;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 8: View de Detalhamento - Top Empresas Suspeitas\\r\\n-- ========================================================================\\r\\nDROP VIEW IF EXISTS teste.dimp_top_suspeitas;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE VIEW teste.dimp_top_suspeitas AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.uf,\\r\\n    s.nm_cnae1,\\r\\n    s.total_recebido_cnpj,\\r\\n    s.total_recebido_cpf,\\r\\n    s.total_geral,\\r\\n    s.perc_recebido_cpf,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.score_risco_final,\\r\\n    s.classificacao_risco,\\r\\n    s.score_proporcao,\\r\\n    s.score_volume_cpf,\\r\\n    s.score_qtd_socios,\\r\\n    s.score_desvio_regime,\\r\\n    s.score_consistencia\\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND s.perc_recebido_cpf >= 30\\r\\nORDER BY s.score_risco_final DESC;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 9: Detalhamento de Opera\\u00e7\\u00f5es Suspeitas (Transa\\u00e7\\u00f5es Detalhadas)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_operacoes_suspeitas;\\r\\n\\r\\nCREATE TABLE teste.dimp_operacoes_suspeitas AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.score_risco_final,\\r\\n    s.classificacao_risco,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.cd_cnae1 AS cnae_principal,\\r\\n    s.nm_cnae1 AS descricao_cnae,\\r\\n    p.cpf_socio AS identificador,\\r\\n    'CPF' AS tipo_identificador,\\r\\n    p.nome_socio,\\r\\n    p.nm_qualificacao,\\r\\n    p.referencia,\\r\\n    p.vl_credito,\\r\\n    p.vl_debito,\\r\\n    p.vl_pix,\\r\\n    p.vl_boleto,\\r\\n    p.vl_transferencia,\\r\\n    p.vl_dinheiro,\\r\\n    p.vl_total\\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_pagamentos_cpf p \\r\\n    ON s.cnpj = p.cnpj\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND p.referencia BETWEEN 202401 AND 202509\\r\\nORDER BY s.score_risco_final DESC, p.vl_total DESC;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 10: An\\u00e1lise de Rede - S\\u00f3cios que Recebem em M\\u00faltiplas Empresas\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_socios_multiplas_empresas;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_socios_multiplas_empresas AS\\r\\nWITH socios_multi AS (\\r\\n    SELECT\\r\\n        cpf_socio,\\r\\n        nome_socio,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas,\\r\\n        SUM(vl_total) AS total_recebido,\\r\\n        GROUP_CONCAT(DISTINCT cnpj, ', ') AS cnpjs_relacionados\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cpf_socio, nome_socio\\r\\n    HAVING COUNT(DISTINCT cnpj) > 1\\r\\n)\\r\\nSELECT\\r\\n    sm.*,\\r\\n    CASE \\r\\n        WHEN sm.qtd_empresas >= 10 THEN 'MUITO ALTO'\\r\\n        WHEN sm.qtd_empresas >= 5 THEN 'ALTO'\\r\\n        WHEN sm.qtd_empresas >= 3 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS nivel_dispersao\\r\\nFROM socios_multi sm\\r\\nORDER BY sm.qtd_empresas DESC, sm.total_recebido DESC;\\r\\n\\r\\n-- ========================================================================\\r\\n-- QUERIES DE VERIFICA\\u00c7\\u00c3O E ESTAT\\u00cdSTICAS\\r\\n-- ========================================================================\\r\\n\\r\\n-- Estat\\u00edsticas Gerais\\r\\nSELECT \\r\\n    COUNT(*) AS total_empresas_analisadas,\\r\\n    SUM(CASE WHEN perc_recebido_cpf > 50 THEN 1 ELSE 0 END) AS empresas_mais_50pct_cpf,\\r\\n    SUM(CASE WHEN classificacao_risco = 'ALTO' THEN 1 ELSE 0 END) AS empresas_risco_alto,\\r\\n    ROUND(AVG(perc_recebido_cpf), 2) AS media_perc_cpf,\\r\\n    ROUND(AVG(total_geral), 2) AS media_valor_total\\r\\nFROM teste.dimp_score_final;\\r\\n\\r\\n-- Top 20 Empresas por Score de Risco\\r\\nSELECT * FROM teste.dimp_top_suspeitas LIMIT 20;\", \"statementsList\": [\"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_comparacao_cnpj_cpf AS\\r\\nWITH\\r\\n-- Agrega\\u00e7\\u00e3o por empresa (CNPJ)\\r\\npagto_cnpj AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT referencia) AS meses_com_pagto_cnpj,\\r\\n        SUM(vl_total) AS total_cnpj,\\r\\n        SUM(vl_credito) AS total_credito_cnpj,\\r\\n        SUM(vl_debito) AS total_debito_cnpj,\\r\\n        SUM(vl_pix) AS total_pix_cnpj,\\r\\n        AVG(vl_total) AS media_mensal_cnpj\\r\\n    FROM teste.dimp_pagamentos_cnpj\\r\\n    GROUP BY cnpj\\r\\n),\\r\\n-- Agrega\\u00e7\\u00e3o por empresa (via CPF dos s\\u00f3cios)\\r\\npagto_cpf AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT cpf_socio) AS qtd_socios_recebendo,\\r\\n        COUNT(DISTINCT referencia) AS meses_com_pagto_cpf,\\r\\n        SUM(vl_total) AS total_cpf,\\r\\n        SUM(vl_credito) AS total_credito_cpf,\\r\\n        SUM(vl_debito) AS total_debito_cpf,\\r\\n        SUM(vl_pix) AS total_pix_cpf,\\r\\n        AVG(vl_total) AS media_mensal_cpf\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cnpj\\r\\n)\\r\\nSELECT\\r\\n    c.cnpj,\\r\\n    c.nm_razao_social,\\r\\n    c.regime_tributario,\\r\\n    c.municipio,\\r\\n    c.uf,\\r\\n    c.cd_cnae1,\\r\\n    c.nm_cnae1,\\r\\n    COALESCE(pc.total_cnpj, 0) AS total_recebido_cnpj,\\r\\n    COALESCE(pf.total_cpf, 0) AS total_recebido_cpf,\\r\\n    COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) AS total_geral,\\r\\n    COALESCE(pf.qtd_socios_recebendo, 0) AS qtd_socios_recebendo,\\r\\n    COALESCE(pc.meses_com_pagto_cnpj, 0) AS meses_com_pagto_cnpj,\\r\\n    COALESCE(pf.meses_com_pagto_cpf, 0) AS meses_com_pagto_cpf,\\r\\n    -- Percentuais\\r\\n    CASE \\r\\n        WHEN COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0 \\r\\n        THEN ROUND(COALESCE(pf.total_cpf, 0) * 100.0 / \\r\\n             (COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0)), 2)\\r\\n        ELSE 0 \\r\\n    END AS perc_recebido_cpf,\\r\\n    CASE \\r\\n        WHEN COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0 \\r\\n        THEN ROUND(COALESCE(pc.total_cnpj, 0) * 100.0 / \\r\\n             (COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0)), 2)\\r\\n        ELSE 0 \\r\\n    END AS perc_recebido_cnpj,\\r\\n    -- Detalhamento por tipo de pagamento\\r\\n    COALESCE(pc.total_pix_cnpj, 0) AS pix_cnpj,\\r\\n    COALESCE(pf.total_pix_cpf, 0) AS pix_cpf,\\r\\n    COALESCE(pc.total_credito_cnpj, 0) AS credito_cnpj,\\r\\n    COALESCE(pf.total_credito_cpf, 0) AS credito_cpf,\\r\\n    COALESCE(pc.total_debito_cnpj, 0) AS debito_cnpj,\\r\\n    COALESCE(pf.total_debito_cpf, 0) AS debito_cpf\\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN pagto_cnpj pc ON c.cnpj = pc.cnpj\\r\\nLEFT JOIN pagto_cpf pf ON c.cnpj = pf.cnpj\\r\\nWHERE COALESCE(pc.total_cnpj, 0) + COALESCE(pf.total_cpf, 0) > 0;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 6: Tabela de M\\u00e9tricas e Scores de Risco\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_metricas_risco;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_metricas_risco AS\\r\\nWITH\\r\\n-- Estat\\u00edsticas por regime tribut\\u00e1rio\\r\\npercentis_regime AS (\\r\\n    SELECT\\r\\n        regime_tributario,\\r\\n        perc_recebido_cpf,\\r\\n        PERCENT_RANK() OVER (PARTITION BY regime_tributario ORDER BY perc_recebido_cpf) AS percentil_rank\\r\\n    FROM teste.dimp_comparacao_cnpj_cpf\\r\\n),\\r\\nestatisticas_regime AS (\\r\\n    SELECT\\r\\n        regime_tributario,\\r\\n        AVG(perc_recebido_cpf) AS media_perc_cpf_regime,\\r\\n        STDDEV(perc_recebido_cpf) AS desvio_perc_cpf_regime,\\r\\n        MAX(CASE WHEN percentil_rank >= 0.75 THEN perc_recebido_cpf ELSE NULL END) AS percentil_75_cpf\\r\\n    FROM percentis_regime\\r\\n    GROUP BY regime_tributario\\r\\n)\\r\\nSELECT\\r\\n    c.*,\\r\\n    e.media_perc_cpf_regime,\\r\\n    e.desvio_perc_cpf_regime,\\r\\n    e.percentil_75_cpf,\\r\\n    -- Score 1: Propor\\u00e7\\u00e3o CPF vs CNPJ (0-100)\\r\\n    CASE \\r\\n        WHEN c.perc_recebido_cpf >= 80 THEN 100\\r\\n        WHEN c.perc_recebido_cpf >= 60 THEN 80\\r\\n        WHEN c.perc_recebido_cpf >= 40 THEN 60\\r\\n        WHEN c.perc_recebido_cpf >= 20 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_proporcao,\\r\\n    -- Score 2: Volume absoluto recebido em CPF (0-100)\\r\\n    CASE \\r\\n        WHEN c.total_recebido_cpf >= 1000000 THEN 100\\r\\n        WHEN c.total_recebido_cpf >= 500000 THEN 80\\r\\n        WHEN c.total_recebido_cpf >= 100000 THEN 60\\r\\n        WHEN c.total_recebido_cpf >= 50000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_volume_cpf,\\r\\n    -- Score 3: Quantidade de s\\u00f3cios recebendo (0-100)\\r\\n    CASE \\r\\n        WHEN c.qtd_socios_recebendo >= 5 THEN 100\\r\\n        WHEN c.qtd_socios_recebendo >= 3 THEN 80\\r\\n        WHEN c.qtd_socios_recebendo >= 2 THEN 60\\r\\n        WHEN c.qtd_socios_recebendo >= 1 THEN 40\\r\\n        ELSE 0\\r\\n    END AS score_qtd_socios,\\r\\n    -- Score 4: Desvio em rela\\u00e7\\u00e3o ao regime tribut\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN e.desvio_perc_cpf_regime > 0 AND \\r\\n             c.perc_recebido_cpf > e.media_perc_cpf_regime + (2 * e.desvio_perc_cpf_regime) \\r\\n        THEN 100\\r\\n        WHEN e.desvio_perc_cpf_regime > 0 AND \\r\\n             c.perc_recebido_cpf > e.media_perc_cpf_regime + e.desvio_perc_cpf_regime \\r\\n        THEN 70\\r\\n        WHEN c.perc_recebido_cpf > e.percentil_75_cpf \\r\\n        THEN 50\\r\\n        ELSE 25\\r\\n    END AS score_desvio_regime,\\r\\n    -- Score 5: Consist\\u00eancia temporal (recebe em CPF todo m\\u00eas) (0-100)\\r\\n    CASE \\r\\n        WHEN c.meses_com_pagto_cpf >= 9 THEN 100\\r\\n        WHEN c.meses_com_pagto_cpf >= 6 THEN 70\\r\\n        WHEN c.meses_com_pagto_cpf >= 3 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_consistencia\\r\\nFROM teste.dimp_comparacao_cnpj_cpf c\\r\\nLEFT JOIN estatisticas_regime e ON c.regime_tributario = e.regime_tributario;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 7: Score Final de Risco\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_score_final;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_score_final AS\\r\\nSELECT\\r\\n    m.*,\\r\\n    -- Score Final (m\\u00e9dia ponderada)\\r\\n    ROUND(\\r\\n        (m.score_proporcao * 0.30) + \\r\\n        (m.score_volume_cpf * 0.25) + \\r\\n        (m.score_qtd_socios * 0.15) + \\r\\n        (m.score_desvio_regime * 0.20) + \\r\\n        (m.score_consistencia * 0.10),\\r\\n    2) AS score_risco_final,\\r\\n    -- Classifica\\u00e7\\u00e3o de Risco\\r\\n    CASE \\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 80 THEN 'ALTO'\\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 60 THEN 'M\\u00c9DIO-ALTO'\\r\\n        WHEN (m.score_proporcao * 0.30 + m.score_volume_cpf * 0.25 + \\r\\n              m.score_qtd_socios * 0.15 + m.score_desvio_regime * 0.20 + \\r\\n              m.score_consistencia * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco\\r\\nFROM teste.dimp_metricas_risco m;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 8: View de Detalhamento - Top Empresas Suspeitas\\r\\n-- ========================================================================\\r\\nDROP VIEW IF EXISTS teste.dimp_top_suspeitas;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE VIEW teste.dimp_top_suspeitas AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.uf,\\r\\n    s.nm_cnae1,\\r\\n    s.total_recebido_cnpj,\\r\\n    s.total_recebido_cpf,\\r\\n    s.total_geral,\\r\\n    s.perc_recebido_cpf,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.score_risco_final,\\r\\n    s.classificacao_risco,\\r\\n    s.score_proporcao,\\r\\n    s.score_volume_cpf,\\r\\n    s.score_qtd_socios,\\r\\n    s.score_desvio_regime,\\r\\n    s.score_consistencia\\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND s.perc_recebido_cpf >= 30\\r\\nORDER BY s.score_risco_final DESC;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 9: Detalhamento de Opera\\u00e7\\u00f5es Suspeitas (Transa\\u00e7\\u00f5es Detalhadas)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_operacoes_suspeitas;\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_operacoes_suspeitas AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.score_risco_final,\\r\\n    s.classificacao_risco,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.cd_cnae1 AS cnae_principal,\\r\\n    s.nm_cnae1 AS descricao_cnae,\\r\\n    p.cpf_socio AS identificador,\\r\\n    'CPF' AS tipo_identificador,\\r\\n    p.nome_socio,\\r\\n    p.nm_qualificacao,\\r\\n    p.referencia,\\r\\n    p.vl_credito,\\r\\n    p.vl_debito,\\r\\n    p.vl_pix,\\r\\n    p.vl_boleto,\\r\\n    p.vl_transferencia,\\r\\n    p.vl_dinheiro,\\r\\n    p.vl_total\\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_pagamentos_cpf p \\r\\n    ON s.cnpj = p.cnpj\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND p.referencia BETWEEN 202401 AND 202509\\r\\nORDER BY s.score_risco_final DESC, p.vl_total DESC;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 10: An\\u00e1lise de Rede - S\\u00f3cios que Recebem em M\\u00faltiplas Empresas\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_socios_multiplas_empresas;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_socios_multiplas_empresas AS\\r\\nWITH socios_multi AS (\\r\\n    SELECT\\r\\n        cpf_socio,\\r\\n        nome_socio,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas,\\r\\n        SUM(vl_total) AS total_recebido,\\r\\n        GROUP_CONCAT(DISTINCT cnpj, ', ') AS cnpjs_relacionados\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cpf_socio, nome_socio\\r\\n    HAVING COUNT(DISTINCT cnpj) > 1\\r\\n)\\r\\nSELECT\\r\\n    sm.*,\\r\\n    CASE \\r\\n        WHEN sm.qtd_empresas >= 10 THEN 'MUITO ALTO'\\r\\n        WHEN sm.qtd_empresas >= 5 THEN 'ALTO'\\r\\n        WHEN sm.qtd_empresas >= 3 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS nivel_dispersao\\r\\nFROM socios_multi sm\\r\\nORDER BY sm.qtd_empresas DESC, sm.total_recebido DESC;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- QUERIES DE VERIFICA\\u00c7\\u00c3O E ESTAT\\u00cdSTICAS\\r\\n-- ========================================================================\\r\\n\\r\\n-- Estat\\u00edsticas Gerais\\r\\nSELECT \\r\\n    COUNT(*) AS total_empresas_analisadas,\\r\\n    SUM(CASE WHEN perc_recebido_cpf > 50 THEN 1 ELSE 0 END) AS empresas_mais_50pct_cpf,\\r\\n    SUM(CASE WHEN classificacao_risco = 'ALTO' THEN 1 ELSE 0 END) AS empresas_risco_alto,\\r\\n    ROUND(AVG(perc_recebido_cpf), 2) AS media_perc_cpf,\\r\\n    ROUND(AVG(total_geral), 2) AS media_valor_total\\r\\nFROM teste.dimp_score_final;\", \"\\r\\n\\r\\n-- Top 20 Empresas por Score de Risco\\r\\nSELECT * FROM teste.dimp_top_suspeitas LIMIT 20;\"], \"aceSize\": 100, \"status\": \"ready\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n\\r\\nCREATE VIEW teste.dimp_top_suspeitas AS\\r\\nSELECT\\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.uf,\\r\\n    s.nm_cnae1,\\r\\n    s.total_recebido_cnpj,\\r\\n    s.total_recebido_cpf,\\r\\n    s.total_geral,\\r\\n    s.perc_recebido_cpf,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.score_risco_final,\\r\\n    s.classificacao_risco,\\r\\n    s.score_proporcao,\\r\\n    s.score_volume_cpf,\\r\\n    s.score_qtd_socios,\\r\\n    s.score_desvio_regime,\\r\\n    s.score_consistencia\\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND s.perc_recebido_cpf >= 30\\r\\nORDER BY s.score_risco_final DESC;\", \"result\": {\"id\": \"397958e0-9e06-58ca-08af-3bea6f61202d\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"AzZMOJhoR6eQb7Fz2ZrIlw==\", \"guid\": \"N/4ePRGIQL4AAAAATnAdAA==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"9e43c9c8f5001812:07d789462cead0b2\", \"session_id\": 21689, \"session_type\": \"impala\", \"statement_id\": 31, \"has_more_statements\": false, \"statements_count\": 32, \"previous_statement_hash\": \"9179342c3603932b08d44f754dc9c2a5523d98bb498f04d96025efbc\", \"start\": {\"row\": 417, \"column\": 0}, \"end\": {\"row\": 418, \"column\": 47}, \"statement\": \"-- Top 20 Empresas por Score de Risco\\nSELECT * FROM teste.dimp_top_suspeitas LIMIT 20\"}, \"meta\": [], \"rows\": 20, \"hasMore\": false, \"statement_id\": 31, \"statement_range\": {\"start\": {\"row\": 417, \"column\": 0}, \"end\": {\"row\": 418, \"column\": 47}}, \"statements_count\": 1, \"previous_statement_hash\": null, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": -1, \"filteredMeta\": [], \"fetchedOnce\": false, \"startTime\": \"2025-10-16T17:37:44.586Z\", \"endTime\": \"2025-10-16T17:37:46.029Z\", \"executionTime\": 1443, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 0, \"hasSomeResults\": false}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": -1, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"cnpj\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"total_recebido_cpf\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"cnpj\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [\"total_recebido_cpf\"], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": null, \"getLogsTimeout\": null, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760636264258, \"lastAceSelectionRowOffset\": 0, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 78, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 149, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false, \"is_history\": false}",
    "extra": "",
    "search": "-- ========================================================================\r\n-- PROJETO DIMP - ANÁLISE DE MEIOS DE PAGAMENTO\r\n-- Objetivo: Investigar empresas que recebem pagamentos via CPF de sócios\r\n-- Database: teste.dimp_*\r\n-- Período: 2024-2025 (ajustar conforme necessário)\r\n-- ========================================================================\r\n\r\n-- ========================================================================\r\n-- PARTE 1: Tabela Base - CNPJs Ativos para Análise\r\n-- ========================================================================\r\nDROP TABLE IF EXISTS teste.dimp_cnpj_base;\r\nSET REQUEST_POOL = 'medium';\r\n\r\nCREATE TABLE teste.dimp_cnpj_base AS\r\nSELECT DISTINCT\r\n    e.nu_cnpj AS cnpj,\r\n    e.nm_razao_social,\r\n    e.nm_fantasia,\r\n    e.nm_sit_cadastral,\r\n    e.dt_sit_cadastral,\r\n    e.nm_reg_apuracao AS regime_tributario,\r\n    e.cd_cnae1,\r\n    e.nm_cnae1,\r\n    e.nm_munic AS municipio,\r\n    e.cd_uf AS uf,\r\n    e.dt_inicio_icms,\r\n    e.dt_constituicao_empresa,\r\n    e.nu_telefone,\r\n    e.nm_email\r\nFROM usr_sat_ods.vw_cad_contrib e\r\nWHERE e.nm_sit_cadastral IN ('ATIVA', 'ATIVO')\r\n    AND e.dt_inicio_icms IS NOT NULL;\r\n\r\n-- ========================================================================\r\n-- PARTE 2: Tabela de Sócios Ativos\r\n-- ========================================================================\r\nDROP TABLE IF EXISTS teste.dimp_socios;\r\nSET REQUEST_POOL = 'medium';\r\n\r\nCREATE TABLE teste.dimp_socios AS\r\nSELECT \r\n    REGEXP_REPLACE(TRIM(v.nu_cnpj_princ), '[^0-9]', '') AS cnpj,\r\n    REGEXP_REPLACE(TRIM(v.nu_cnpj_cpf_secund), '[^0-9]', '') AS cpf_socio,\r\n    v.nm_relacao,\r\n    v.nm_qualificacao,\r\n    v.dt_inicio_relacao,\r\n    v.dt_fim_relacao,\r\n    v.pe_capital_empresa AS perc_participacao,\r\n    v.sn_relacao_ativa,\r\n    pf.nm_pessoa AS nome_socio,\r\n    pf.nm_munic AS municipio_socio,\r\n    pf.nu_telefone AS telefone_socio,\r\n    bc.dtnasc AS data_nascimento,\r\n    bc.nomemae AS nome_mae\r\nFROM usr_sat_ods.vw_cad_vinculo v\r\nLEFT JOIN usr_sat_",
    "last_modified": "2025-10-17T18:20:44.491",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "da7315d7-ca92-4187-8468-1a3ec4322c51",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 165253,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "DIMP: Análises",
    "description": "",
    "uuid": "6aad44e8-4efd-3804-b9f5-aadab3ab9f8d",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 165253, \"uuid\": \"c8a98471-8aa3-4314-b809-b7c299e25114\", \"name\": \"DIMP: An\\u00e1lises\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"6aad44e8-4efd-3804-b9f5-aadab3ab9f8d\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"c817d959-5581-59dd-98db-fa352821f6ca\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 921, \"column\": 22}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 1, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ============================================================================\\r\\n-- SISTEMA DE CONSULTAS ANAL\\u00cdTICAS - PROJETO DIMP\\r\\n-- Investiga\\u00e7\\u00e3o de Meios de Pagamento (CNPJ vs CPF de S\\u00f3cios)\\r\\n-- Receita Estadual de Santa Catarina\\r\\n-- Database: teste.dimp_*\\r\\n-- ============================================================================\\r\\n\\r\\n-- CONFIGURA\\u00c7\\u00c3O INICIAL\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 1: ESTAT\\u00cdSTICAS GERAIS DO PROJETO (VIS\\u00c3O EXECUTIVA)\\r\\n-- ============================================================================\\r\\n\\r\\n-- 1.1. PANORAMA GERAL DO PROJETO DIMP\\r\\n-- Objetivo: Vis\\u00e3o executiva completa do monitoramento\\r\\nSELECT\\r\\n    '1.1. PANORAMA GERAL DIMP' AS consulta,\\r\\n    \\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT cnpj) AS total_empresas_base,\\r\\n    COUNT(DISTINCT CASE WHEN regime_tributario IS NOT NULL THEN cnpj END) AS empresas_com_regime,\\r\\n    \\r\\n    -- Empresas com Movimenta\\u00e7\\u00e3o\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cnpj) AS empresas_recebem_cnpj,\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cpf) AS empresas_socios_recebem_cpf,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_socios) AS total_socios_ativos,\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_pagamentos_cpf) AS socios_recebendo_pagamentos,\\r\\n    \\r\\n    -- Percentuais Cr\\u00edticos\\r\\n    ROUND((SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cpf) * 100.0 / \\r\\n          COUNT(DISTINCT cnpj), 2) AS perc_empresas_socios_recebem,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras Agregadas\\r\\n    (SELECT ROUND(SUM(vl_total) / 1000000, 2) \\r\\n     FROM teste.dimp_pagamentos_cnpj) AS total_recebido_cnpj_milhoes,\\r\\n    \\r\\n    (SELECT ROUND(SUM(vl_total) / 1000000, 2) \\r\\n     FROM teste.dimp_pagamentos_cpf) AS total_recebido_cpf_milhoes,\\r\\n    \\r\\n    (SELECT ROUND((SUM(vl_total) / 1000000), 2)\\r\\n     FROM (\\r\\n         SELECT vl_total FROM teste.dimp_pagamentos_cnpj\\r\\n         UNION ALL\\r\\n         SELECT vl_total FROM teste.dimp_pagamentos_cpf\\r\\n     ) t) AS total_geral_milhoes,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_consulta\\r\\n    \\r\\nFROM teste.dimp_cnpj_base;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 1.2. DISTRIBUI\\u00c7\\u00c3O POR REGIME TRIBUT\\u00c1RIO\\r\\n-- Objetivo: Entender o perfil das empresas monitoradas\\r\\nSELECT\\r\\n    '1.2. DISTRIBUI\\u00c7\\u00c3O POR REGIME TRIBUT\\u00c1RIO' AS consulta,\\r\\n    \\r\\n    c.regime_tributario,\\r\\n    COUNT(DISTINCT c.cnpj) AS qtd_empresas,\\r\\n    ROUND(COUNT(DISTINCT c.cnpj) * 100.0 / SUM(COUNT(DISTINCT c.cnpj)) OVER(), 2) AS percentual,\\r\\n    \\r\\n    -- Empresas com Pagamentos\\r\\n    COUNT(DISTINCT CASE WHEN comp.cnpj IS NOT NULL THEN c.cnpj END) AS empresas_com_movto,\\r\\n    COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) AS empresas_socios_recebem,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras\\r\\n    ROUND(AVG(COALESCE(comp.total_recebido_cnpj, 0)), 2) AS media_recebido_cnpj,\\r\\n    ROUND(AVG(COALESCE(comp.total_recebido_cpf, 0)), 2) AS media_recebido_cpf,\\r\\n    ROUND(AVG(COALESCE(comp.perc_recebido_cpf, 0)), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) * 100.0 / \\r\\n          COUNT(DISTINCT c.cnpj), 2) AS perc_socios_recebem\\r\\n    \\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN teste.dimp_comparacao_cnpj_cpf comp ON c.cnpj = comp.cnpj\\r\\nWHERE c.regime_tributario IS NOT NULL\\r\\nGROUP BY c.regime_tributario\\r\\nORDER BY qtd_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 1.3. DISTRIBUI\\u00c7\\u00c3O POR MUNIC\\u00cdPIO (TOP 20)\\r\\n-- Objetivo: Concentra\\u00e7\\u00e3o geogr\\u00e1fica do fen\\u00f4meno\\r\\nSELECT\\r\\n    '1.3. TOP 20 MUNIC\\u00cdPIOS' AS consulta,\\r\\n    \\r\\n    c.municipio,\\r\\n    c.uf,\\r\\n    COUNT(DISTINCT c.cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Empresas com S\\u00f3cios Recebendo\\r\\n    COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) AS empresas_socios_recebem,\\r\\n    ROUND(COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) * 100.0 / \\r\\n          COUNT(DISTINCT c.cnpj), 2) AS perc_socios_recebem,\\r\\n    \\r\\n    -- Volume Financeiro\\r\\n    ROUND(SUM(COALESCE(comp.total_recebido_cpf, 0)) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(SUM(COALESCE(comp.total_recebido_cnpj, 0)) / 1000, 2) AS total_cnpj_milhares,\\r\\n    \\r\\n    -- Score M\\u00e9dio\\r\\n    ROUND(AVG(COALESCE(s.score_risco_final, 0)), 2) AS score_medio_municipio\\r\\n    \\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN teste.dimp_comparacao_cnpj_cpf comp ON c.cnpj = comp.cnpj\\r\\nLEFT JOIN teste.dimp_score_final s ON c.cnpj = s.cnpj\\r\\nWHERE c.municipio IS NOT NULL\\r\\nGROUP BY c.municipio, c.uf\\r\\nORDER BY empresas_socios_recebem DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 1.4. DISTRIBUI\\u00c7\\u00c3O POR CNAE (TOP 30)\\r\\n-- Objetivo: Identificar setores mais afetados\\r\\nSELECT\\r\\n    '1.4. TOP 30 CNAEs COM PAGAMENTOS VIA CPF' AS consulta,\\r\\n    \\r\\n    c.cd_cnae1,\\r\\n    c.nm_cnae1,\\r\\n    COUNT(DISTINCT c.cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Empresas com S\\u00f3cios Recebendo\\r\\n    COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) AS empresas_cpf,\\r\\n    ROUND(COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) * 100.0 / \\r\\n          COUNT(DISTINCT c.cnpj), 2) AS perc_cpf,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(SUM(COALESCE(comp.total_recebido_cpf, 0)) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(AVG(COALESCE(comp.perc_recebido_cpf, 0)), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Risco\\r\\n    COUNT(DISTINCT CASE WHEN s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO') \\r\\n          THEN c.cnpj END) AS empresas_alto_risco\\r\\n    \\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN teste.dimp_comparacao_cnpj_cpf comp ON c.cnpj = comp.cnpj\\r\\nLEFT JOIN teste.dimp_score_final s ON c.cnpj = s.cnpj\\r\\nWHERE c.nm_cnae1 IS NOT NULL\\r\\nGROUP BY c.cd_cnae1, c.nm_cnae1\\r\\nHAVING COUNT(DISTINCT CASE WHEN comp.total_recebido_cpf > 0 THEN c.cnpj END) > 0\\r\\nORDER BY total_cpf_milhares DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 1.5. ESTAT\\u00cdSTICAS DE MEIOS DE PAGAMENTO\\r\\n-- Objetivo: Entender a distribui\\u00e7\\u00e3o dos tipos de pagamento\\r\\nSELECT\\r\\n    '1.5. DISTRIBUI\\u00c7\\u00c3O MEIOS DE PAGAMENTO' AS consulta,\\r\\n    'VIA_CNPJ' AS tipo_recebedor,\\r\\n    ROUND(SUM(pix_cnpj) / 1000, 2) AS total_pix_milhares,\\r\\n    ROUND(SUM(credito_cnpj) / 1000, 2) AS total_credito_milhares,\\r\\n    ROUND(SUM(debito_cnpj) / 1000, 2) AS total_debito_milhares,\\r\\n    ROUND(SUM(total_recebido_cnpj) / 1000, 2) AS total_geral_milhares,\\r\\n    COUNT(DISTINCT cnpj) AS qtd_empresas,\\r\\n    ROUND(AVG(total_recebido_cnpj), 2) AS media_por_empresa\\r\\nFROM teste.dimp_comparacao_cnpj_cpf\\r\\nWHERE total_recebido_cnpj > 0\\r\\n\\r\\nUNION ALL\\r\\n\\r\\nSELECT\\r\\n    '1.5. DISTRIBUI\\u00c7\\u00c3O MEIOS DE PAGAMENTO' AS consulta,\\r\\n    'VIA_CPF_SOCIOS' AS tipo_recebedor,\\r\\n    ROUND(SUM(pix_cpf) / 1000, 2) AS total_pix_milhares,\\r\\n    ROUND(SUM(credito_cpf) / 1000, 2) AS total_credito_milhares,\\r\\n    ROUND(SUM(debito_cpf) / 1000, 2) AS total_debito_milhares,\\r\\n    ROUND(SUM(total_recebido_cpf) / 1000, 2) AS total_geral_milhares,\\r\\n    COUNT(DISTINCT cnpj) AS qtd_empresas,\\r\\n    ROUND(AVG(total_recebido_cpf), 2) AS media_por_empresa\\r\\nFROM teste.dimp_comparacao_cnpj_cpf\\r\\nWHERE total_recebido_cpf > 0;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 2: CONSULTAS ANAL\\u00cdTICAS - RANKINGS E PADR\\u00d5ES\\r\\n-- ============================================================================\\r\\n\\r\\n-- 2.1. TOP 50 EMPRESAS POR SCORE DE RISCO\\r\\n-- Objetivo: Lista priorizada para fiscaliza\\u00e7\\u00e3o\\r\\nSELECT\\r\\n    '2.1. TOP 50 EMPRESAS - SCORE DE RISCO' AS consulta,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_final DESC) AS ranking,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.uf,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Scores\\r\\n    ROUND(s.score_risco_final, 2) AS score_final,\\r\\n    s.classificacao_risco,\\r\\n    ROUND(s.score_proporcao, 0) AS score_proporcao,\\r\\n    ROUND(s.score_volume_cpf, 0) AS score_volume,\\r\\n    ROUND(s.score_qtd_socios, 0) AS score_socios,\\r\\n    ROUND(s.score_desvio_regime, 0) AS score_desvio,\\r\\n    ROUND(s.score_consistencia, 0) AS score_consistencia,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS cnpj_milhares,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Contexto\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nORDER BY s.score_risco_final DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.2. EMPRESAS COM MAIS DE 80% RECEBIDO VIA CPF\\r\\n-- Objetivo: Casos extremos de concentra\\u00e7\\u00e3o em CPF\\r\\nSELECT\\r\\n    '2.2. EMPRESAS >80% RECEBIMENTO VIA CPF' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00f5es\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    ROUND(s.perc_recebido_cnpj, 2) AS perc_cnpj,\\r\\n    \\r\\n    -- Valores Absolutos\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS total_cnpj_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_geral_milhares,\\r\\n    \\r\\n    -- Detalhamento\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    s.meses_com_pagto_cnpj,\\r\\n    \\r\\n    -- Risco\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Contexto do Regime\\r\\n    ROUND(s.media_perc_cpf_regime, 2) AS media_regime,\\r\\n    ROUND(s.percentil_75_cpf, 2) AS p75_regime\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.perc_recebido_cpf >= 80\\r\\nORDER BY s.total_recebido_cpf DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.3. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE PERCENTUAL CPF\\r\\n-- Objetivo: Entender a distribui\\u00e7\\u00e3o do fen\\u00f4meno\\r\\nSELECT\\r\\n    '2.3. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS % CPF' AS consulta,\\r\\n    \\r\\n    CASE\\r\\n        WHEN perc_recebido_cpf >= 90 THEN '90-100% (EXTREMO)'\\r\\n        WHEN perc_recebido_cpf >= 70 THEN '70-89% (MUITO ALTO)'\\r\\n        WHEN perc_recebido_cpf >= 50 THEN '50-69% (ALTO)'\\r\\n        WHEN perc_recebido_cpf >= 30 THEN '30-49% (M\\u00c9DIO)'\\r\\n        WHEN perc_recebido_cpf >= 10 THEN '10-29% (BAIXO)'\\r\\n        ELSE '0-9% (M\\u00cdNIMO)'\\r\\n    END AS faixa_percentual,\\r\\n    \\r\\n    COUNT(*) AS qtd_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS perc_empresas,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(SUM(total_recebido_cpf) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(AVG(total_recebido_cpf), 2) AS media_cpf,\\r\\n    \\r\\n    -- Scores\\r\\n    ROUND(AVG(score_risco_final), 2) AS score_medio,\\r\\n    COUNT(CASE WHEN classificacao_risco = 'ALTO' THEN 1 END) AS qtd_alto_risco,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    ROUND(AVG(qtd_socios_recebendo), 1) AS media_socios,\\r\\n    SUM(qtd_socios_recebendo) AS total_socios\\r\\n    \\r\\nFROM teste.dimp_score_final\\r\\nGROUP BY faixa_percentual\\r\\nORDER BY MIN(perc_recebido_cpf) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.4. AN\\u00c1LISE POR CLASSIFICA\\u00c7\\u00c3O DE RISCO\\r\\n-- Objetivo: Distribui\\u00e7\\u00e3o de empresas por n\\u00edvel de risco\\r\\nSELECT\\r\\n    '2.4. DISTRIBUI\\u00c7\\u00c3O POR CLASSIFICA\\u00c7\\u00c3O DE RISCO' AS consulta,\\r\\n    \\r\\n    classificacao_risco,\\r\\n    COUNT(*) AS qtd_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentual,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras\\r\\n    ROUND(SUM(total_recebido_cpf) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(AVG(total_recebido_cpf), 2) AS media_cpf,\\r\\n    ROUND(SUM(total_geral) / 1000, 2) AS total_geral_milhares,\\r\\n    \\r\\n    -- Scores Componentes\\r\\n    ROUND(AVG(score_proporcao), 1) AS media_score_proporcao,\\r\\n    ROUND(AVG(score_volume_cpf), 1) AS media_score_volume,\\r\\n    ROUND(AVG(score_qtd_socios), 1) AS media_score_socios,\\r\\n    ROUND(AVG(score_desvio_regime), 1) AS media_score_desvio,\\r\\n    ROUND(AVG(score_consistencia), 1) AS media_score_consistencia,\\r\\n    \\r\\n    -- Contexto\\r\\n    ROUND(AVG(perc_recebido_cpf), 2) AS media_perc_cpf,\\r\\n    ROUND(AVG(qtd_socios_recebendo), 1) AS media_socios,\\r\\n    ROUND(AVG(meses_com_pagto_cpf), 1) AS media_meses_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final\\r\\nGROUP BY classificacao_risco\\r\\nORDER BY \\r\\n    CASE classificacao_risco\\r\\n        WHEN 'ALTO' THEN 1\\r\\n        WHEN 'M\\u00c9DIO-ALTO' THEN 2\\r\\n        WHEN 'M\\u00c9DIO' THEN 3\\r\\n        WHEN 'BAIXO' THEN 4\\r\\n    END;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.5. S\\u00d3CIOS QUE RECEBEM EM M\\u00daLTIPLAS EMPRESAS\\r\\n-- Objetivo: Identificar padr\\u00e3o de dispers\\u00e3o\\r\\nSELECT\\r\\n    '2.5. S\\u00d3CIOS EM M\\u00daLTIPLAS EMPRESAS (TOP 50)' AS consulta,\\r\\n    ROW_NUMBER() OVER (ORDER BY qtd_empresas DESC, total_recebido DESC) AS ranking,\\r\\n    \\r\\n    cpf_socio,\\r\\n    nome_socio,\\r\\n    qtd_empresas,\\r\\n    nivel_dispersao,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(total_recebido / 1000, 2) AS total_recebido_milhares,\\r\\n    ROUND(total_recebido / qtd_empresas, 2) AS media_por_empresa,\\r\\n    \\r\\n    -- Empresas (limitado para visualiza\\u00e7\\u00e3o)\\r\\n    CASE \\r\\n        WHEN LENGTH(cnpjs_relacionados) > 100 \\r\\n        THEN CONCAT(SUBSTRING(cnpjs_relacionados, 1, 97), '...')\\r\\n        ELSE cnpjs_relacionados\\r\\n    END AS empresas_resumo\\r\\n    \\r\\nFROM teste.dimp_socios_multiplas_empresas\\r\\nORDER BY qtd_empresas DESC, total_recebido DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.6. AN\\u00c1LISE TEMPORAL - CONSIST\\u00caNCIA DE RECEBIMENTO\\r\\n-- Objetivo: Empresas que recebem via CPF consistentemente\\r\\nSELECT\\r\\n    '2.6. CONSIST\\u00caNCIA TEMPORAL RECEBIMENTO CPF' AS consulta,\\r\\n    \\r\\n    CASE\\r\\n        WHEN meses_com_pagto_cpf >= 9 THEN '9+ meses (MUITO CONSISTENTE)'\\r\\n        WHEN meses_com_pagto_cpf >= 6 THEN '6-8 meses (CONSISTENTE)'\\r\\n        WHEN meses_com_pagto_cpf >= 3 THEN '3-5 meses (MODERADO)'\\r\\n        ELSE '1-2 meses (ESPOR\\u00c1DICO)'\\r\\n    END AS faixa_consistencia,\\r\\n    \\r\\n    COUNT(*) AS qtd_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentual,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(SUM(total_recebido_cpf) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(AVG(total_recebido_cpf), 2) AS media_cpf,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00f5es\\r\\n    ROUND(AVG(perc_recebido_cpf), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Risco\\r\\n    ROUND(AVG(score_risco_final), 2) AS score_medio,\\r\\n    COUNT(CASE WHEN classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO') THEN 1 END) AS qtd_alto_risco\\r\\n    \\r\\nFROM teste.dimp_score_final\\r\\nWHERE meses_com_pagto_cpf > 0\\r\\nGROUP BY faixa_consistencia\\r\\nORDER BY MIN(meses_com_pagto_cpf) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: AN\\u00c1LISES COMPLETAS - DOSSI\\u00caS DETALHADOS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca COMPLETO DE EMPRESA\\r\\n-- Substitua '00000000000000' pelo CNPJ desejado\\r\\nSELECT\\r\\n    '3.1. DOSSI\\u00ca COMPLETO EMPRESA' AS consulta,\\r\\n    \\r\\n    -- IDENTIFICA\\u00c7\\u00c3O\\r\\n    c.cnpj,\\r\\n    c.nm_razao_social,\\r\\n    c.nm_fantasia,\\r\\n    c.cd_cnae1,\\r\\n    c.nm_cnae1,\\r\\n    c.municipio,\\r\\n    c.uf,\\r\\n    c.regime_tributario,\\r\\n    c.nm_sit_cadastral,\\r\\n    c.dt_inicio_icms,\\r\\n    \\r\\n    -- SCORE E RISCO\\r\\n    ROUND(s.score_risco_final, 2) AS score_final,\\r\\n    s.classificacao_risco,\\r\\n    ROUND(s.score_proporcao, 0) AS score_proporcao,\\r\\n    ROUND(s.score_volume_cpf, 0) AS score_volume,\\r\\n    ROUND(s.score_qtd_socios, 0) AS score_socios,\\r\\n    ROUND(s.score_desvio_regime, 0) AS score_desvio,\\r\\n    ROUND(s.score_consistencia, 0) AS score_consistencia,\\r\\n    \\r\\n    -- VALORES TOTAIS\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS total_cnpj_milhares,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_geral_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    ROUND(s.perc_recebido_cnpj, 2) AS perc_cnpj,\\r\\n    \\r\\n    -- DETALHAMENTO MEIOS PAGAMENTO\\r\\n    ROUND(s.pix_cnpj / 1000, 2) AS pix_cnpj_milhares,\\r\\n    ROUND(s.pix_cpf / 1000, 2) AS pix_cpf_milhares,\\r\\n    ROUND(s.credito_cnpj / 1000, 2) AS credito_cnpj_milhares,\\r\\n    ROUND(s.credito_cpf / 1000, 2) AS credito_cpf_milhares,\\r\\n    ROUND(s.debito_cnpj / 1000, 2) AS debito_cnpj_milhares,\\r\\n    ROUND(s.debito_cpf / 1000, 2) AS debito_cpf_milhares,\\r\\n    \\r\\n    -- S\\u00d3CIOS\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    s.meses_com_pagto_cnpj,\\r\\n    \\r\\n    -- CONTEXTO DO REGIME\\r\\n    ROUND(s.media_perc_cpf_regime, 2) AS media_regime,\\r\\n    ROUND(s.desvio_perc_cpf_regime, 2) AS desvio_regime,\\r\\n    ROUND(s.percentil_75_cpf, 2) AS p75_regime\\r\\n    \\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN teste.dimp_score_final s ON c.cnpj = s.cnpj\\r\\nWHERE c.cnpj = '00000000000000';  -- << MODIFICAR CNPJ AQUI\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.2. S\\u00d3CIOS DA EMPRESA COM RECEBIMENTOS\\r\\n-- Lista todos os s\\u00f3cios que recebem pagamentos\\r\\nWITH socios_outras_empresas AS (\\r\\n    SELECT \\r\\n        cpf_socio,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas_relacionadas\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cpf_socio\\r\\n)\\r\\nSELECT\\r\\n    '3.2. S\\u00d3CIOS DA EMPRESA COM RECEBIMENTOS' AS consulta,\\r\\n    \\r\\n    p.cpf_socio,\\r\\n    p.nome_socio,\\r\\n    p.nm_qualificacao,\\r\\n    ROUND(p.perc_participacao, 2) AS perc_participacao,\\r\\n    \\r\\n    -- Totais por S\\u00f3cio\\r\\n    ROUND(SUM(p.vl_total) / 1000, 2) AS total_recebido_milhares,\\r\\n    COUNT(DISTINCT p.referencia) AS meses_recebeu,\\r\\n    \\r\\n    -- Detalhamento Meios Pagamento\\r\\n    ROUND(SUM(p.vl_credito) / 1000, 2) AS total_credito_milhares,\\r\\n    ROUND(SUM(p.vl_debito) / 1000, 2) AS total_debito_milhares,\\r\\n    ROUND(SUM(p.vl_pix) / 1000, 2) AS total_pix_milhares,\\r\\n    \\r\\n    -- Verificar se est\\u00e1 em outras empresas\\r\\n    COALESCE(soe.qtd_empresas_relacionadas, 0) AS qtd_empresas_relacionadas\\r\\n    \\r\\nFROM teste.dimp_pagamentos_cpf p\\r\\nLEFT JOIN socios_outras_empresas soe ON p.cpf_socio = soe.cpf_socio\\r\\nWHERE p.cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nGROUP BY p.cpf_socio, p.nome_socio, p.nm_qualificacao, p.perc_participacao, soe.qtd_empresas_relacionadas\\r\\nORDER BY SUM(p.vl_total) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.3. OPERA\\u00c7\\u00d5ES DETALHADAS DA EMPRESA\\r\\n-- Transa\\u00e7\\u00f5es individuais suspeitas\\r\\nSELECT\\r\\n    '3.3. OPERA\\u00c7\\u00d5ES DETALHADAS SUSPEITAS' AS consulta,\\r\\n    \\r\\n    o.data_operacao,\\r\\n    o.tipo_identificador,\\r\\n    o.cnpj_cpf_operacao,\\r\\n    o.tipo_natureza,\\r\\n    o.tipo_operacao,\\r\\n    ROUND(o.valor_operacao, 2) AS valor_operacao,\\r\\n    o.bandeira,\\r\\n    o.tipo_pix,\\r\\n    o.uf_operacao,\\r\\n    o.municipio_operacao,\\r\\n    \\r\\n    -- Se for CPF, identificar o s\\u00f3cio\\r\\n    CASE \\r\\n        WHEN o.tipo_identificador = 'CPF' THEN s.nome_socio\\r\\n        ELSE NULL\\r\\n    END AS nome_socio\\r\\n    \\r\\nFROM teste.dimp_operacoes_suspeitas o\\r\\nLEFT JOIN teste.dimp_socios s ON \\r\\n    o.tipo_identificador = 'CPF' \\r\\n    AND s.cpf_socio = o.cnpj_cpf_operacao \\r\\n    AND s.cnpj = o.cnpj\\r\\nWHERE o.cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nORDER BY o.data_operacao DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.4. EVOLU\\u00c7\\u00c3O MENSAL DA EMPRESA\\r\\n-- Acompanhamento m\\u00eas a m\\u00eas dos recebimentos\\r\\nWITH empresareceb AS (\\r\\n    SELECT \\r\\n        cnpj,\\r\\n        referencia,\\r\\n        SUM(vl_total) AS vl_cnpj\\r\\n    FROM teste.dimp_pagamentos_cnpj\\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n    GROUP BY cnpj, referencia\\r\\n),\\r\\nsociosreceb AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        referencia,\\r\\n        SUM(vl_total) AS vl_cpf,\\r\\n        COUNT(DISTINCT cpf_socio) AS qtd_socios\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n    GROUP BY cnpj, referencia\\r\\n)\\r\\nSELECT\\r\\n    '3.4. EVOLU\\u00c7\\u00c3O MENSAL' AS consulta,\\r\\n    \\r\\n    COALESCE(e.referencia, s.referencia) AS mes_referencia,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(COALESCE(e.vl_cnpj, 0) / 1000, 2) AS recebido_cnpj_milhares,\\r\\n    ROUND(COALESCE(s.vl_cpf, 0) / 1000, 2) AS recebido_cpf_milhares,\\r\\n    ROUND((COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)) / 1000, 2) AS total_milhares,\\r\\n    \\r\\n    -- Percentual CPF\\r\\n    CASE \\r\\n        WHEN (COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)) > 0\\r\\n        THEN ROUND(COALESCE(s.vl_cpf, 0) * 100.0 / \\r\\n             (COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)), 2)\\r\\n        ELSE 0\\r\\n    END AS perc_cpf,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    COALESCE(s.qtd_socios, 0) AS socios_receberam\\r\\n    \\r\\nFROM empresareceb e\\r\\nFULL OUTER JOIN sociosreceb s ON e.referencia = s.referencia\\r\\nORDER BY mes_referencia DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.5. EMPRESAS SIMILARES (MESMO SETOR E PORTE)\\r\\n-- Compara\\u00e7\\u00e3o com pares\\r\\nSELECT\\r\\n    '3.5. EMPRESAS SIMILARES (MESMO CNAE)' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.municipio,\\r\\n    s.regime_tributario,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS cnpj_milhares,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Risco\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nWHERE c.cd_cnae1 = (\\r\\n    SELECT cd_cnae1 \\r\\n    FROM teste.dimp_cnpj_base \\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n)\\r\\nAND s.cnpj != '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nAND s.total_geral > 0\\r\\nORDER BY s.score_risco_final DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPEC\\u00cdFICAS E PADR\\u00d5ES SUSPEITOS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 4.1. EMPRESAS COM ALTO VALOR E ALTA PROPOR\\u00c7\\u00c3O CPF\\r\\n-- Objetivo: Maior impacto potencial\\r\\nSELECT\\r\\n    '4.1. ALTO VALOR + ALTA PROPOR\\u00c7\\u00c3O CPF' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Contexto\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- Impacto Estimado\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS impacto_potencial_milhares\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.total_recebido_cpf >= 100000  -- M\\u00ednimo R$ 100 mil via CPF\\r\\n  AND s.perc_recebido_cpf >= 50  -- Pelo menos 50% via CPF\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.2. PADR\\u00c3O \\\"FANTASMA\\\" - S\\u00d3 RECEBE VIA CPF\\r\\n-- Objetivo: Empresas que NUNCA recebem no CNPJ\\r\\nSELECT\\r\\n    '4.2. PADR\\u00c3O FANTASMA (100% CPF)' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    c.dt_inicio_icms,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    \\r\\n    -- Detalhamento Meios\\r\\n    ROUND(s.pix_cpf / 1000, 2) AS pix_milhares,\\r\\n    ROUND(s.credito_cpf / 1000, 2) AS credito_milhares,\\r\\n    ROUND(s.debito_cpf / 1000, 2) AS debito_milhares,\\r\\n    \\r\\n    -- Contatos\\r\\n    c.nu_telefone,\\r\\n    c.nm_email\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nWHERE s.perc_recebido_cpf = 100\\r\\n  AND s.total_recebido_cpf >= 10000  -- M\\u00ednimo R$ 10 mil\\r\\nORDER BY s.total_recebido_cpf DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.3. AN\\u00c1LISE DE REDE - S\\u00d3CIOS COMPARTILHADOS\\r\\n-- Objetivo: Identificar conex\\u00f5es entre empresas suspeitas\\r\\nWITH empresas_suspeitas AS (\\r\\n    SELECT DISTINCT cnpj\\r\\n    FROM teste.dimp_score_final\\r\\n    WHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n),\\r\\nsocios_risco AS (\\r\\n    SELECT DISTINCT \\r\\n        s.cpf_socio,\\r\\n        s.nome_socio\\r\\n    FROM teste.dimp_socios s\\r\\n    INNER JOIN empresas_suspeitas es ON s.cnpj = es.cnpj\\r\\n)\\r\\nSELECT\\r\\n    '4.3. REDE DE S\\u00d3CIOS EM EMPRESAS SUSPEITAS' AS consulta,\\r\\n    \\r\\n    sr.cpf_socio,\\r\\n    sr.nome_socio,\\r\\n    COUNT(DISTINCT s.cnpj) AS qtd_empresas_suspeitas,\\r\\n    \\r\\n    -- Empresas conectadas\\r\\n    GROUP_CONCAT(DISTINCT c.nm_razao_social, ' | ') AS empresas,\\r\\n    \\r\\n    -- Valores totais\\r\\n    ROUND(SUM(COALESCE(comp.total_recebido_cpf, 0)) / 1000, 2) AS total_cpf_milhares,\\r\\n    \\r\\n    -- Qualifica\\u00e7\\u00f5es\\r\\n    GROUP_CONCAT(DISTINCT s.nm_qualificacao, ', ') AS qualificacoes\\r\\n    \\r\\nFROM socios_risco sr\\r\\nINNER JOIN teste.dimp_socios s ON sr.cpf_socio = s.cpf_socio\\r\\nINNER JOIN empresas_suspeitas es ON s.cnpj = es.cnpj\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nLEFT JOIN teste.dimp_comparacao_cnpj_cpf comp ON s.cnpj = comp.cnpj\\r\\nGROUP BY sr.cpf_socio, sr.nome_socio\\r\\nHAVING COUNT(DISTINCT s.cnpj) >= 2\\r\\nORDER BY COUNT(DISTINCT s.cnpj) DESC, SUM(COALESCE(comp.total_recebido_cpf, 0)) DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.4. DESVIO EXTREMO VS REGIME TRIBUT\\u00c1RIO\\r\\n-- Objetivo: Empresas muito fora do padr\\u00e3o do seu regime\\r\\nSELECT\\r\\n    '4.4. DESVIO EXTREMO VS REGIME' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Compara\\u00e7\\u00e3o com Regime\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf_empresa,\\r\\n    ROUND(s.media_perc_cpf_regime, 2) AS media_regime,\\r\\n    ROUND(s.percentil_75_cpf, 2) AS p75_regime,\\r\\n    ROUND(s.perc_recebido_cpf - s.media_perc_cpf_regime, 2) AS diferenca_vs_media,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_milhares,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    ROUND(s.score_desvio_regime, 0) AS score_desvio,\\r\\n    \\r\\n    -- Contexto\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.perc_recebido_cpf > (s.media_perc_cpf_regime + (2 * s.desvio_perc_cpf_regime))\\r\\n  AND s.total_recebido_cpf >= 10000\\r\\nORDER BY (s.perc_recebido_cpf - s.media_perc_cpf_regime) DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.5. CONCENTRA\\u00c7\\u00c3O EM POUCOS S\\u00d3CIOS\\r\\n-- Objetivo: Alto valor concentrado em poucos CPFs\\r\\nSELECT\\r\\n    '4.5. ALTO VALOR EM POUCOS S\\u00d3CIOS' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    ROUND(s.total_recebido_cpf / s.qtd_socios_recebendo, 2) AS media_por_socio,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00e3o\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Consist\\u00eancia\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.qtd_socios_recebendo <= 3\\r\\n  AND s.total_recebido_cpf >= 50000  -- M\\u00ednimo R$ 50 mil\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO E ALERTAS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 5.1. DASHBOARD EXECUTIVO - KPIs PRINCIPAIS\\r\\nSELECT\\r\\n    '5.1. DASHBOARD EXECUTIVO DIMP' AS consulta,\\r\\n    \\r\\n    -- Volume Geral\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_cnpj_base) AS total_empresas,\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_score_final) AS empresas_com_movto,\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_socios) AS total_socios,\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_pagamentos_cpf) AS socios_recebendo,\\r\\n    \\r\\n    -- Valores Totais (em milh\\u00f5es)\\r\\n    ROUND((SELECT SUM(vl_total) FROM teste.dimp_pagamentos_cnpj) / 1000000, 2) AS total_cnpj_milhoes,\\r\\n    ROUND((SELECT SUM(vl_total) FROM teste.dimp_pagamentos_cpf) / 1000000, 2) AS total_cpf_milhoes,\\r\\n    \\r\\n    -- Percentual M\\u00e9dio\\r\\n    ROUND((SELECT AVG(perc_recebido_cpf) FROM teste.dimp_score_final), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Risco\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE classificacao_risco = 'ALTO') AS qtd_alto_risco,\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE classificacao_risco = 'M\\u00c9DIO-ALTO') AS qtd_medio_alto,\\r\\n    \\r\\n    -- Padr\\u00f5es Extremos\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE perc_recebido_cpf >= 80) AS empresas_80pct_cpf,\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE perc_recebido_cpf = 100) AS empresas_100pct_cpf,\\r\\n    \\r\\n    -- Impacto Financeiro\\r\\n    ROUND((SELECT SUM(total_recebido_cpf) FROM teste.dimp_score_final \\r\\n           WHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')) / 1000000, 2) AS impacto_alto_risco_milhoes,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 5.2. ALERTAS PRIORIT\\u00c1RIOS PARA A\\u00c7\\u00c3O\\r\\n-- Objetivo: Lista de trabalho di\\u00e1ria\\r\\nSELECT\\r\\n    '5.2. ALERTAS PRIORIT\\u00c1RIOS' AS consulta,\\r\\n    \\r\\n    ROW_NUMBER() OVER (ORDER BY \\r\\n        CASE s.classificacao_risco\\r\\n            WHEN 'ALTO' THEN 1\\r\\n            WHEN 'M\\u00c9DIO-ALTO' THEN 2\\r\\n            ELSE 3\\r\\n        END,\\r\\n        s.score_risco_final DESC\\r\\n    ) AS prioridade,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.municipio,\\r\\n    s.regime_tributario,\\r\\n    \\r\\n    -- Tipo de Alerta\\r\\n    CASE\\r\\n        WHEN s.perc_recebido_cpf = 100 AND s.total_recebido_cpf >= 100000\\r\\n            THEN 'CR\\u00cdTICO: 100% CPF + Alto Valor (>100k)'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 90 AND s.meses_com_pagto_cpf >= 6\\r\\n            THEN 'CR\\u00cdTICO: 90%+ CPF Consistente (6+ meses)'\\r\\n        \\r\\n        WHEN s.qtd_socios_recebendo >= 5 AND s.total_recebido_cpf >= 50000\\r\\n            THEN 'ALTO: M\\u00faltiplos S\\u00f3cios (5+) + Alto Valor'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 80\\r\\n            THEN 'ALTO: 80%+ Recebido via CPF'\\r\\n        \\r\\n        WHEN s.score_desvio_regime >= 100 AND s.total_recebido_cpf >= 30000\\r\\n            THEN 'ALTO: Desvio Extremo vs Regime'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 50 AND s.total_recebido_cpf >= 100000\\r\\n            THEN 'M\\u00c9DIO: 50%+ CPF com Alto Volume'\\r\\n        \\r\\n        ELSE 'MONITORAMENTO: Acompanhar Evolu\\u00e7\\u00e3o'\\r\\n    END AS tipo_alerta,\\r\\n    \\r\\n    -- M\\u00e9tricas\\r\\n    ROUND(s.score_risco_final, 2) AS score,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Sugerida\\r\\n    CASE\\r\\n        WHEN s.perc_recebido_cpf = 100 \\r\\n            THEN 'Fiscaliza\\u00e7\\u00e3o: Verificar exist\\u00eancia efetiva da empresa'\\r\\n        WHEN s.perc_recebido_cpf >= 80 \\r\\n            THEN 'Auditoria: Analisar natureza dos pagamentos e relacionamento com s\\u00f3cios'\\r\\n        WHEN s.qtd_socios_recebendo >= 5 \\r\\n            THEN 'Investiga\\u00e7\\u00e3o: Verificar estrutura societ\\u00e1ria e opera\\u00e7\\u00e3o real'\\r\\n        WHEN s.score_desvio_regime >= 80 \\r\\n            THEN 'An\\u00e1lise: Comparar com empresas similares do regime'\\r\\n        ELSE 'Monitoramento: Acompanhar evolu\\u00e7\\u00e3o mensal'\\r\\n    END AS acao_sugerida\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n   OR s.perc_recebido_cpf >= 70\\r\\n   OR (s.qtd_socios_recebendo >= 5 AND s.total_recebido_cpf >= 30000)\\r\\nORDER BY prioridade\\r\\nLIMIT 100;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 5.3. INDICADORES DE TEND\\u00caNCIA\\r\\n-- Objetivo: Acompanhar evolu\\u00e7\\u00e3o temporal do fen\\u00f4meno\\r\\nWITH evolucao_mensal AS (\\r\\n    SELECT \\r\\n        referencia,\\r\\n        COUNT(DISTINCT cnpj) AS empresas_periodo,\\r\\n        SUM(vl_total) AS volume_periodo\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY referencia\\r\\n)\\r\\nSELECT\\r\\n    '5.3. EVOLU\\u00c7\\u00c3O TEMPORAL DO FEN\\u00d4MENO' AS consulta,\\r\\n    \\r\\n    referencia AS mes,\\r\\n    empresas_periodo AS qtd_empresas,\\r\\n    ROUND(volume_periodo / 1000, 2) AS volume_milhares,\\r\\n    ROUND(volume_periodo / empresas_periodo, 2) AS media_por_empresa,\\r\\n    \\r\\n    -- Varia\\u00e7\\u00e3o vs m\\u00eas anterior\\r\\n    ROUND((volume_periodo - LAG(volume_periodo) OVER (ORDER BY referencia)) * 100.0 / \\r\\n          LAG(volume_periodo) OVER (ORDER BY referencia), 2) AS variacao_pct,\\r\\n    \\r\\n    -- Acumulado\\r\\n    ROUND(SUM(volume_periodo) OVER (ORDER BY referencia) / 1000, 2) AS acumulado_milhares\\r\\n    \\r\\nFROM evolucao_mensal\\r\\nORDER BY referencia DESC;\", \"statementsList\": [\"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 2.6. AN\\u00c1LISE TEMPORAL - CONSIST\\u00caNCIA DE RECEBIMENTO\\r\\n-- Objetivo: Empresas que recebem via CPF consistentemente\\r\\nSELECT\\r\\n    '2.6. CONSIST\\u00caNCIA TEMPORAL RECEBIMENTO CPF' AS consulta,\\r\\n    \\r\\n    CASE\\r\\n        WHEN meses_com_pagto_cpf >= 9 THEN '9+ meses (MUITO CONSISTENTE)'\\r\\n        WHEN meses_com_pagto_cpf >= 6 THEN '6-8 meses (CONSISTENTE)'\\r\\n        WHEN meses_com_pagto_cpf >= 3 THEN '3-5 meses (MODERADO)'\\r\\n        ELSE '1-2 meses (ESPOR\\u00c1DICO)'\\r\\n    END AS faixa_consistencia,\\r\\n    \\r\\n    COUNT(*) AS qtd_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentual,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(SUM(total_recebido_cpf) / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(AVG(total_recebido_cpf), 2) AS media_cpf,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00f5es\\r\\n    ROUND(AVG(perc_recebido_cpf), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Risco\\r\\n    ROUND(AVG(score_risco_final), 2) AS score_medio,\\r\\n    COUNT(CASE WHEN classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO') THEN 1 END) AS qtd_alto_risco\\r\\n    \\r\\nFROM teste.dimp_score_final\\r\\nWHERE meses_com_pagto_cpf > 0\\r\\nGROUP BY faixa_consistencia\\r\\nORDER BY MIN(meses_com_pagto_cpf) DESC;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: AN\\u00c1LISES COMPLETAS - DOSSI\\u00caS DETALHADOS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca COMPLETO DE EMPRESA\\r\\n-- Substitua '00000000000000' pelo CNPJ desejado\\r\\nSELECT\\r\\n    '3.1. DOSSI\\u00ca COMPLETO EMPRESA' AS consulta,\\r\\n    \\r\\n    -- IDENTIFICA\\u00c7\\u00c3O\\r\\n    c.cnpj,\\r\\n    c.nm_razao_social,\\r\\n    c.nm_fantasia,\\r\\n    c.cd_cnae1,\\r\\n    c.nm_cnae1,\\r\\n    c.municipio,\\r\\n    c.uf,\\r\\n    c.regime_tributario,\\r\\n    c.nm_sit_cadastral,\\r\\n    c.dt_inicio_icms,\\r\\n    \\r\\n    -- SCORE E RISCO\\r\\n    ROUND(s.score_risco_final, 2) AS score_final,\\r\\n    s.classificacao_risco,\\r\\n    ROUND(s.score_proporcao, 0) AS score_proporcao,\\r\\n    ROUND(s.score_volume_cpf, 0) AS score_volume,\\r\\n    ROUND(s.score_qtd_socios, 0) AS score_socios,\\r\\n    ROUND(s.score_desvio_regime, 0) AS score_desvio,\\r\\n    ROUND(s.score_consistencia, 0) AS score_consistencia,\\r\\n    \\r\\n    -- VALORES TOTAIS\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS total_cnpj_milhares,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS total_cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_geral_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    ROUND(s.perc_recebido_cnpj, 2) AS perc_cnpj,\\r\\n    \\r\\n    -- DETALHAMENTO MEIOS PAGAMENTO\\r\\n    ROUND(s.pix_cnpj / 1000, 2) AS pix_cnpj_milhares,\\r\\n    ROUND(s.pix_cpf / 1000, 2) AS pix_cpf_milhares,\\r\\n    ROUND(s.credito_cnpj / 1000, 2) AS credito_cnpj_milhares,\\r\\n    ROUND(s.credito_cpf / 1000, 2) AS credito_cpf_milhares,\\r\\n    ROUND(s.debito_cnpj / 1000, 2) AS debito_cnpj_milhares,\\r\\n    ROUND(s.debito_cpf / 1000, 2) AS debito_cpf_milhares,\\r\\n    \\r\\n    -- S\\u00d3CIOS\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    s.meses_com_pagto_cnpj,\\r\\n    \\r\\n    -- CONTEXTO DO REGIME\\r\\n    ROUND(s.media_perc_cpf_regime, 2) AS media_regime,\\r\\n    ROUND(s.desvio_perc_cpf_regime, 2) AS desvio_regime,\\r\\n    ROUND(s.percentil_75_cpf, 2) AS p75_regime\\r\\n    \\r\\nFROM teste.dimp_cnpj_base c\\r\\nLEFT JOIN teste.dimp_score_final s ON c.cnpj = s.cnpj\\r\\nWHERE c.cnpj = '00000000000000';\", \"  -- << MODIFICAR CNPJ AQUI\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.2. S\\u00d3CIOS DA EMPRESA COM RECEBIMENTOS\\r\\n-- Lista todos os s\\u00f3cios que recebem pagamentos\\r\\nWITH socios_outras_empresas AS (\\r\\n    SELECT \\r\\n        cpf_socio,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas_relacionadas\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY cpf_socio\\r\\n)\\r\\nSELECT\\r\\n    '3.2. S\\u00d3CIOS DA EMPRESA COM RECEBIMENTOS' AS consulta,\\r\\n    \\r\\n    p.cpf_socio,\\r\\n    p.nome_socio,\\r\\n    p.nm_qualificacao,\\r\\n    ROUND(p.perc_participacao, 2) AS perc_participacao,\\r\\n    \\r\\n    -- Totais por S\\u00f3cio\\r\\n    ROUND(SUM(p.vl_total) / 1000, 2) AS total_recebido_milhares,\\r\\n    COUNT(DISTINCT p.referencia) AS meses_recebeu,\\r\\n    \\r\\n    -- Detalhamento Meios Pagamento\\r\\n    ROUND(SUM(p.vl_credito) / 1000, 2) AS total_credito_milhares,\\r\\n    ROUND(SUM(p.vl_debito) / 1000, 2) AS total_debito_milhares,\\r\\n    ROUND(SUM(p.vl_pix) / 1000, 2) AS total_pix_milhares,\\r\\n    \\r\\n    -- Verificar se est\\u00e1 em outras empresas\\r\\n    COALESCE(soe.qtd_empresas_relacionadas, 0) AS qtd_empresas_relacionadas\\r\\n    \\r\\nFROM teste.dimp_pagamentos_cpf p\\r\\nLEFT JOIN socios_outras_empresas soe ON p.cpf_socio = soe.cpf_socio\\r\\nWHERE p.cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nGROUP BY p.cpf_socio, p.nome_socio, p.nm_qualificacao, p.perc_participacao, soe.qtd_empresas_relacionadas\\r\\nORDER BY SUM(p.vl_total) DESC;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.3. OPERA\\u00c7\\u00d5ES DETALHADAS DA EMPRESA\\r\\n-- Transa\\u00e7\\u00f5es individuais suspeitas\\r\\nSELECT\\r\\n    '3.3. OPERA\\u00c7\\u00d5ES DETALHADAS SUSPEITAS' AS consulta,\\r\\n    \\r\\n    o.data_operacao,\\r\\n    o.tipo_identificador,\\r\\n    o.cnpj_cpf_operacao,\\r\\n    o.tipo_natureza,\\r\\n    o.tipo_operacao,\\r\\n    ROUND(o.valor_operacao, 2) AS valor_operacao,\\r\\n    o.bandeira,\\r\\n    o.tipo_pix,\\r\\n    o.uf_operacao,\\r\\n    o.municipio_operacao,\\r\\n    \\r\\n    -- Se for CPF, identificar o s\\u00f3cio\\r\\n    CASE \\r\\n        WHEN o.tipo_identificador = 'CPF' THEN s.nome_socio\\r\\n        ELSE NULL\\r\\n    END AS nome_socio\\r\\n    \\r\\nFROM teste.dimp_operacoes_suspeitas o\\r\\nLEFT JOIN teste.dimp_socios s ON \\r\\n    o.tipo_identificador = 'CPF' \\r\\n    AND s.cpf_socio = o.cnpj_cpf_operacao \\r\\n    AND s.cnpj = o.cnpj\\r\\nWHERE o.cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nORDER BY o.data_operacao DESC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.4. EVOLU\\u00c7\\u00c3O MENSAL DA EMPRESA\\r\\n-- Acompanhamento m\\u00eas a m\\u00eas dos recebimentos\\r\\nWITH empresareceb AS (\\r\\n    SELECT \\r\\n        cnpj,\\r\\n        referencia,\\r\\n        SUM(vl_total) AS vl_cnpj\\r\\n    FROM teste.dimp_pagamentos_cnpj\\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n    GROUP BY cnpj, referencia\\r\\n),\\r\\nsociosreceb AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        referencia,\\r\\n        SUM(vl_total) AS vl_cpf,\\r\\n        COUNT(DISTINCT cpf_socio) AS qtd_socios\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n    GROUP BY cnpj, referencia\\r\\n)\\r\\nSELECT\\r\\n    '3.4. EVOLU\\u00c7\\u00c3O MENSAL' AS consulta,\\r\\n    \\r\\n    COALESCE(e.referencia, s.referencia) AS mes_referencia,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(COALESCE(e.vl_cnpj, 0) / 1000, 2) AS recebido_cnpj_milhares,\\r\\n    ROUND(COALESCE(s.vl_cpf, 0) / 1000, 2) AS recebido_cpf_milhares,\\r\\n    ROUND((COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)) / 1000, 2) AS total_milhares,\\r\\n    \\r\\n    -- Percentual CPF\\r\\n    CASE \\r\\n        WHEN (COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)) > 0\\r\\n        THEN ROUND(COALESCE(s.vl_cpf, 0) * 100.0 / \\r\\n             (COALESCE(e.vl_cnpj, 0) + COALESCE(s.vl_cpf, 0)), 2)\\r\\n        ELSE 0\\r\\n    END AS perc_cpf,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    COALESCE(s.qtd_socios, 0) AS socios_receberam\\r\\n    \\r\\nFROM empresareceb e\\r\\nFULL OUTER JOIN sociosreceb s ON e.referencia = s.referencia\\r\\nORDER BY mes_referencia DESC;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 3.5. EMPRESAS SIMILARES (MESMO SETOR E PORTE)\\r\\n-- Compara\\u00e7\\u00e3o com pares\\r\\nSELECT\\r\\n    '3.5. EMPRESAS SIMILARES (MESMO CNAE)' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.municipio,\\r\\n    s.regime_tributario,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cnpj / 1000, 2) AS cnpj_milhares,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Risco\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- S\\u00f3cios\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nWHERE c.cd_cnae1 = (\\r\\n    SELECT cd_cnae1 \\r\\n    FROM teste.dimp_cnpj_base \\r\\n    WHERE cnpj = '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\n)\\r\\nAND s.cnpj != '00000000000000'  -- << MODIFICAR CNPJ AQUI\\r\\nAND s.total_geral > 0\\r\\nORDER BY s.score_risco_final DESC\\r\\nLIMIT 20;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPEC\\u00cdFICAS E PADR\\u00d5ES SUSPEITOS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 4.1. EMPRESAS COM ALTO VALOR E ALTA PROPOR\\u00c7\\u00c3O CPF\\r\\n-- Objetivo: Maior impacto potencial\\r\\nSELECT\\r\\n    '4.1. ALTO VALOR + ALTA PROPOR\\u00c7\\u00c3O CPF' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Contexto\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- Impacto Estimado\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS impacto_potencial_milhares\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.total_recebido_cpf >= 100000  -- M\\u00ednimo R$ 100 mil via CPF\\r\\n  AND s.perc_recebido_cpf >= 50  -- Pelo menos 50% via CPF\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.2. PADR\\u00c3O \\\"FANTASMA\\\" - S\\u00d3 RECEBE VIA CPF\\r\\n-- Objetivo: Empresas que NUNCA recebem no CNPJ\\r\\nSELECT\\r\\n    '4.2. PADR\\u00c3O FANTASMA (100% CPF)' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    c.dt_inicio_icms,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    \\r\\n    -- Detalhamento Meios\\r\\n    ROUND(s.pix_cpf / 1000, 2) AS pix_milhares,\\r\\n    ROUND(s.credito_cpf / 1000, 2) AS credito_milhares,\\r\\n    ROUND(s.debito_cpf / 1000, 2) AS debito_milhares,\\r\\n    \\r\\n    -- Contatos\\r\\n    c.nu_telefone,\\r\\n    c.nm_email\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nWHERE s.perc_recebido_cpf = 100\\r\\n  AND s.total_recebido_cpf >= 10000  -- M\\u00ednimo R$ 10 mil\\r\\nORDER BY s.total_recebido_cpf DESC;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.3. AN\\u00c1LISE DE REDE - S\\u00d3CIOS COMPARTILHADOS\\r\\n-- Objetivo: Identificar conex\\u00f5es entre empresas suspeitas\\r\\nWITH empresas_suspeitas AS (\\r\\n    SELECT DISTINCT cnpj\\r\\n    FROM teste.dimp_score_final\\r\\n    WHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n),\\r\\nsocios_risco AS (\\r\\n    SELECT DISTINCT \\r\\n        s.cpf_socio,\\r\\n        s.nome_socio\\r\\n    FROM teste.dimp_socios s\\r\\n    INNER JOIN empresas_suspeitas es ON s.cnpj = es.cnpj\\r\\n)\\r\\nSELECT\\r\\n    '4.3. REDE DE S\\u00d3CIOS EM EMPRESAS SUSPEITAS' AS consulta,\\r\\n    \\r\\n    sr.cpf_socio,\\r\\n    sr.nome_socio,\\r\\n    COUNT(DISTINCT s.cnpj) AS qtd_empresas_suspeitas,\\r\\n    \\r\\n    -- Empresas conectadas\\r\\n    GROUP_CONCAT(DISTINCT c.nm_razao_social, ' | ') AS empresas,\\r\\n    \\r\\n    -- Valores totais\\r\\n    ROUND(SUM(COALESCE(comp.total_recebido_cpf, 0)) / 1000, 2) AS total_cpf_milhares,\\r\\n    \\r\\n    -- Qualifica\\u00e7\\u00f5es\\r\\n    GROUP_CONCAT(DISTINCT s.nm_qualificacao, ', ') AS qualificacoes\\r\\n    \\r\\nFROM socios_risco sr\\r\\nINNER JOIN teste.dimp_socios s ON sr.cpf_socio = s.cpf_socio\\r\\nINNER JOIN empresas_suspeitas es ON s.cnpj = es.cnpj\\r\\nINNER JOIN teste.dimp_cnpj_base c ON s.cnpj = c.cnpj\\r\\nLEFT JOIN teste.dimp_comparacao_cnpj_cpf comp ON s.cnpj = comp.cnpj\\r\\nGROUP BY sr.cpf_socio, sr.nome_socio\\r\\nHAVING COUNT(DISTINCT s.cnpj) >= 2\\r\\nORDER BY COUNT(DISTINCT s.cnpj) DESC, SUM(COALESCE(comp.total_recebido_cpf, 0)) DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.4. DESVIO EXTREMO VS REGIME TRIBUT\\u00c1RIO\\r\\n-- Objetivo: Empresas muito fora do padr\\u00e3o do seu regime\\r\\nSELECT\\r\\n    '4.4. DESVIO EXTREMO VS REGIME' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    s.nm_cnae1,\\r\\n    \\r\\n    -- Compara\\u00e7\\u00e3o com Regime\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf_empresa,\\r\\n    ROUND(s.media_perc_cpf_regime, 2) AS media_regime,\\r\\n    ROUND(s.percentil_75_cpf, 2) AS p75_regime,\\r\\n    ROUND(s.perc_recebido_cpf - s.media_perc_cpf_regime, 2) AS diferenca_vs_media,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.total_geral / 1000, 2) AS total_milhares,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    ROUND(s.score_desvio_regime, 0) AS score_desvio,\\r\\n    \\r\\n    -- Contexto\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.perc_recebido_cpf > (s.media_perc_cpf_regime + (2 * s.desvio_perc_cpf_regime))\\r\\n  AND s.total_recebido_cpf >= 10000\\r\\nORDER BY (s.perc_recebido_cpf - s.media_perc_cpf_regime) DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.5. CONCENTRA\\u00c7\\u00c3O EM POUCOS S\\u00d3CIOS\\r\\n-- Objetivo: Alto valor concentrado em poucos CPFs\\r\\nSELECT\\r\\n    '4.5. ALTO VALOR EM POUCOS S\\u00d3CIOS' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    ROUND(s.total_recebido_cpf / s.qtd_socios_recebendo, 2) AS media_por_socio,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00e3o\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Consist\\u00eancia\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.qtd_socios_recebendo <= 3\\r\\n  AND s.total_recebido_cpf >= 50000  -- M\\u00ednimo R$ 50 mil\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- ============================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO E ALERTAS\\r\\n-- ============================================================================\\r\\n\\r\\n-- 5.1. DASHBOARD EXECUTIVO - KPIs PRINCIPAIS\\r\\nSELECT\\r\\n    '5.1. DASHBOARD EXECUTIVO DIMP' AS consulta,\\r\\n    \\r\\n    -- Volume Geral\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_cnpj_base) AS total_empresas,\\r\\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_score_final) AS empresas_com_movto,\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_socios) AS total_socios,\\r\\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_pagamentos_cpf) AS socios_recebendo,\\r\\n    \\r\\n    -- Valores Totais (em milh\\u00f5es)\\r\\n    ROUND((SELECT SUM(vl_total) FROM teste.dimp_pagamentos_cnpj) / 1000000, 2) AS total_cnpj_milhoes,\\r\\n    ROUND((SELECT SUM(vl_total) FROM teste.dimp_pagamentos_cpf) / 1000000, 2) AS total_cpf_milhoes,\\r\\n    \\r\\n    -- Percentual M\\u00e9dio\\r\\n    ROUND((SELECT AVG(perc_recebido_cpf) FROM teste.dimp_score_final), 2) AS media_perc_cpf,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Risco\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE classificacao_risco = 'ALTO') AS qtd_alto_risco,\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE classificacao_risco = 'M\\u00c9DIO-ALTO') AS qtd_medio_alto,\\r\\n    \\r\\n    -- Padr\\u00f5es Extremos\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE perc_recebido_cpf >= 80) AS empresas_80pct_cpf,\\r\\n    (SELECT COUNT(*) FROM teste.dimp_score_final WHERE perc_recebido_cpf = 100) AS empresas_100pct_cpf,\\r\\n    \\r\\n    -- Impacto Financeiro\\r\\n    ROUND((SELECT SUM(total_recebido_cpf) FROM teste.dimp_score_final \\r\\n           WHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')) / 1000000, 2) AS impacto_alto_risco_milhoes,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 5.2. ALERTAS PRIORIT\\u00c1RIOS PARA A\\u00c7\\u00c3O\\r\\n-- Objetivo: Lista de trabalho di\\u00e1ria\\r\\nSELECT\\r\\n    '5.2. ALERTAS PRIORIT\\u00c1RIOS' AS consulta,\\r\\n    \\r\\n    ROW_NUMBER() OVER (ORDER BY \\r\\n        CASE s.classificacao_risco\\r\\n            WHEN 'ALTO' THEN 1\\r\\n            WHEN 'M\\u00c9DIO-ALTO' THEN 2\\r\\n            ELSE 3\\r\\n        END,\\r\\n        s.score_risco_final DESC\\r\\n    ) AS prioridade,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.municipio,\\r\\n    s.regime_tributario,\\r\\n    \\r\\n    -- Tipo de Alerta\\r\\n    CASE\\r\\n        WHEN s.perc_recebido_cpf = 100 AND s.total_recebido_cpf >= 100000\\r\\n            THEN 'CR\\u00cdTICO: 100% CPF + Alto Valor (>100k)'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 90 AND s.meses_com_pagto_cpf >= 6\\r\\n            THEN 'CR\\u00cdTICO: 90%+ CPF Consistente (6+ meses)'\\r\\n        \\r\\n        WHEN s.qtd_socios_recebendo >= 5 AND s.total_recebido_cpf >= 50000\\r\\n            THEN 'ALTO: M\\u00faltiplos S\\u00f3cios (5+) + Alto Valor'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 80\\r\\n            THEN 'ALTO: 80%+ Recebido via CPF'\\r\\n        \\r\\n        WHEN s.score_desvio_regime >= 100 AND s.total_recebido_cpf >= 30000\\r\\n            THEN 'ALTO: Desvio Extremo vs Regime'\\r\\n        \\r\\n        WHEN s.perc_recebido_cpf >= 50 AND s.total_recebido_cpf >= 100000\\r\\n            THEN 'M\\u00c9DIO: 50%+ CPF com Alto Volume'\\r\\n        \\r\\n        ELSE 'MONITORAMENTO: Acompanhar Evolu\\u00e7\\u00e3o'\\r\\n    END AS tipo_alerta,\\r\\n    \\r\\n    -- M\\u00e9tricas\\r\\n    ROUND(s.score_risco_final, 2) AS score,\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    s.qtd_socios_recebendo,\\r\\n    s.meses_com_pagto_cpf,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Sugerida\\r\\n    CASE\\r\\n        WHEN s.perc_recebido_cpf = 100 \\r\\n            THEN 'Fiscaliza\\u00e7\\u00e3o: Verificar exist\\u00eancia efetiva da empresa'\\r\\n        WHEN s.perc_recebido_cpf >= 80 \\r\\n            THEN 'Auditoria: Analisar natureza dos pagamentos e relacionamento com s\\u00f3cios'\\r\\n        WHEN s.qtd_socios_recebendo >= 5 \\r\\n            THEN 'Investiga\\u00e7\\u00e3o: Verificar estrutura societ\\u00e1ria e opera\\u00e7\\u00e3o real'\\r\\n        WHEN s.score_desvio_regime >= 80 \\r\\n            THEN 'An\\u00e1lise: Comparar com empresas similares do regime'\\r\\n        ELSE 'Monitoramento: Acompanhar evolu\\u00e7\\u00e3o mensal'\\r\\n    END AS acao_sugerida\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n   OR s.perc_recebido_cpf >= 70\\r\\n   OR (s.qtd_socios_recebendo >= 5 AND s.total_recebido_cpf >= 30000)\\r\\nORDER BY prioridade\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 5.3. INDICADORES DE TEND\\u00caNCIA\\r\\n-- Objetivo: Acompanhar evolu\\u00e7\\u00e3o temporal do fen\\u00f4meno\\r\\nWITH evolucao_mensal AS (\\r\\n    SELECT \\r\\n        referencia,\\r\\n        COUNT(DISTINCT cnpj) AS empresas_periodo,\\r\\n        SUM(vl_total) AS volume_periodo\\r\\n    FROM teste.dimp_pagamentos_cpf\\r\\n    GROUP BY referencia\\r\\n)\\r\\nSELECT\\r\\n    '5.3. EVOLU\\u00c7\\u00c3O TEMPORAL DO FEN\\u00d4MENO' AS consulta,\\r\\n    \\r\\n    referencia AS mes,\\r\\n    empresas_periodo AS qtd_empresas,\\r\\n    ROUND(volume_periodo / 1000, 2) AS volume_milhares,\\r\\n    ROUND(volume_periodo / empresas_periodo, 2) AS media_por_empresa,\\r\\n    \\r\\n    -- Varia\\u00e7\\u00e3o vs m\\u00eas anterior\\r\\n    ROUND((volume_periodo - LAG(volume_periodo) OVER (ORDER BY referencia)) * 100.0 / \\r\\n          LAG(volume_periodo) OVER (ORDER BY referencia), 2) AS variacao_pct,\\r\\n    \\r\\n    -- Acumulado\\r\\n    ROUND(SUM(volume_periodo) OVER (ORDER BY referencia) / 1000, 2) AS acumulado_milhares\\r\\n    \\r\\nFROM evolucao_mensal\\r\\nORDER BY referencia DESC;\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.5. CONCENTRA\\u00c7\\u00c3O EM POUCOS S\\u00d3CIOS\\r\\n-- Objetivo: Alto valor concentrado em poucos CPFs\\r\\nSELECT\\r\\n    '4.5. ALTO VALOR EM POUCOS S\\u00d3CIOS' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    ROUND(s.total_recebido_cpf / s.qtd_socios_recebendo, 2) AS media_por_socio,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00e3o\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Consist\\u00eancia\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.qtd_socios_recebendo <= 3\\r\\n  AND s.total_recebido_cpf >= 50000  -- M\\u00ednimo R$ 50 mil\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\", \"result\": {\"id\": \"65b79c31-6f58-1868-9469-e78544fee49c\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"AzZMOJhoR6eQb7Fz2ZrIlw==\", \"guid\": \"N95yuVfcR9kAAAAAn1rYng==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"9e43c9c8f5001812:07d789462cead0b2\", \"session_id\": 21689, \"session_type\": \"impala\", \"statement_id\": 0, \"has_more_statements\": false, \"statements_count\": 1, \"previous_statement_hash\": \"0636ce1b07fd9a3713db65dfeff5cb21a29d6d9bd2a8667be56c10ae\", \"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 850}, \"statement\": \"-- PAUSA AQUI\\r\\n\\r\\n-- 4.5. CONCENTRA\\u00c7\\u00c3O EM POUCOS S\\u00d3CIOS\\r\\n-- Objetivo: Alto valor concentrado em poucos CPFs\\r\\nSELECT\\r\\n    '4.5. ALTO VALOR EM POUCOS S\\u00d3CIOS' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    ROUND(s.total_recebido_cpf / s.qtd_socios_recebendo, 2) AS media_por_socio,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00e3o\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Consist\\u00eancia\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.qtd_socios_recebendo <= 3\\r\\n  AND s.total_recebido_cpf >= 50000  -- M\\u00ednimo R$ 50 mil\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50\"}, \"meta\": [], \"rows\": \"50\", \"hasMore\": false, \"statement_id\": 0, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 1, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 12, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"consulta\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"cnpj\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 2}, {\"name\": \"nm_razao_social\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 3}, {\"name\": \"regime_tributario\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 4}, {\"name\": \"municipio\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 5}, {\"name\": \"cpf_milhares\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 6}, {\"name\": \"qtd_socios_recebendo\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 7}, {\"name\": \"media_por_socio\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 8}, {\"name\": \"perc_cpf\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 9}, {\"name\": \"score_risco\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 10}, {\"name\": \"classificacao_risco\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 11}, {\"name\": \"meses_com_pagto_cpf\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 12}], \"fetchedOnce\": false, \"startTime\": \"2025-10-16T17:51:59.084Z\", \"endTime\": \"2025-10-16T17:52:00.447Z\", \"executionTime\": 1363, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 3, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 30948, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"consulta\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"qtd_socios_recebendo\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 31557, \"getLogsTimeout\": 31929, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760637118819, \"lastAceSelectionRowOffset\": 934, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- 4.5. CONCENTRA\\u00c7\\u00c3O EM POUCOS S\\u00d3CIOS\\r\\n-- Objetivo: Alto valor concentrado em poucos CPFs\\r\\nSELECT\\r\\n    '4.5. ALTO VALOR EM POUCOS S\\u00d3CIOS' AS consulta,\\r\\n    \\r\\n    s.cnpj,\\r\\n    s.nm_razao_social,\\r\\n    s.regime_tributario,\\r\\n    s.municipio,\\r\\n    \\r\\n    -- Valores\\r\\n    ROUND(s.total_recebido_cpf / 1000, 2) AS cpf_milhares,\\r\\n    s.qtd_socios_recebendo,\\r\\n    ROUND(s.total_recebido_cpf / s.qtd_socios_recebendo, 2) AS media_por_socio,\\r\\n    \\r\\n    -- Propor\\u00e7\\u00e3o\\r\\n    ROUND(s.perc_recebido_cpf, 2) AS perc_cpf,\\r\\n    \\r\\n    -- Score\\r\\n    ROUND(s.score_risco_final, 2) AS score_risco,\\r\\n    s.classificacao_risco,\\r\\n    \\r\\n    -- Consist\\u00eancia\\r\\n    s.meses_com_pagto_cpf\\r\\n    \\r\\nFROM teste.dimp_score_final s\\r\\nWHERE s.qtd_socios_recebendo <= 3\\r\\n  AND s.total_recebido_cpf >= 50000  -- M\\u00ednimo R$ 50 mil\\r\\nORDER BY s.total_recebido_cpf DESC\\r\\nLIMIT 50;\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 934, \"column\": 25}, \"end\": {\"row\": 934, \"column\": 25}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query d947dc57b972de37:9ed85a9f00000000 100% Complete (3 out of 3)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"d947dc57b972de37:9ed85a9f00000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=d947dc57b972de37:9ed85a9f00000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query d947dc57b972de37:9ed85a9f00000000 100% Complete (3 out of 3)\", \"progress\": 100, \"jobs\": [{\"name\": \"d947dc57b972de37:9ed85a9f00000000\", \"url\": \"/hue/jobbrowser#!id=d947dc57b972de37:9ed85a9f00000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 25461, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 144, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "-- ============================================================================\r\n-- SISTEMA DE CONSULTAS ANALÍTICAS - PROJETO DIMP\r\n-- Investigação de Meios de Pagamento (CNPJ vs CPF de Sócios)\r\n-- Receita Estadual de Santa Catarina\r\n-- Database: teste.dimp_*\r\n-- ============================================================================\r\n\r\n-- CONFIGURAÇÃO INICIAL\r\nSET REQUEST_POOL = 'medium';\r\nSET MEM_LIMIT = 8G;\r\n\r\n-- ============================================================================\r\n-- SEÇÃO 1: ESTATÍSTICAS GERAIS DO PROJETO (VISÃO EXECUTIVA)\r\n-- ============================================================================\r\n\r\n-- 1.1. PANORAMA GERAL DO PROJETO DIMP\r\n-- Objetivo: Visão executiva completa do monitoramento\r\nSELECT\r\n    '1.1. PANORAMA GERAL DIMP' AS consulta,\r\n    \r\n    -- Métricas de Volume\r\n    COUNT(DISTINCT cnpj) AS total_empresas_base,\r\n    COUNT(DISTINCT CASE WHEN regime_tributario IS NOT NULL THEN cnpj END) AS empresas_com_regime,\r\n    \r\n    -- Empresas com Movimentação\r\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cnpj) AS empresas_recebem_cnpj,\r\n    (SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cpf) AS empresas_socios_recebem_cpf,\r\n    \r\n    -- Sócios\r\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_socios) AS total_socios_ativos,\r\n    (SELECT COUNT(DISTINCT cpf_socio) FROM teste.dimp_pagamentos_cpf) AS socios_recebendo_pagamentos,\r\n    \r\n    -- Percentuais Críticos\r\n    ROUND((SELECT COUNT(DISTINCT cnpj) FROM teste.dimp_pagamentos_cpf) * 100.0 / \r\n          COUNT(DISTINCT cnpj), 2) AS perc_empresas_socios_recebem,\r\n    \r\n    -- Métricas Financeiras Agregadas\r\n    (SELECT ROUND(SUM(vl_total) / 1000000, 2) \r\n     FROM teste.dimp_pagamentos_cnpj) AS total_recebido_cnpj_milhoes,\r\n    \r\n    (SELECT ROUND(SUM(vl_total) / 1000000, 2) \r\n     FROM teste.dimp_pagamentos_cpf) AS total_recebido_cpf_milhoes,\r\n    \r\n    (SELECT ROUND((SUM(vl_total) / 1000000), 2)\r\n     FROM (\r\n         SELECT vl_total FROM teste.d",
    "last_modified": "2025-10-16T14:52:11.823",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "da7315d7-ca92-4187-8468-1a3ec4322c51",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 165420,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "DIMP",
    "description": "",
    "uuid": "da7315d7-ca92-4187-8468-1a3ec4322c51",
    "type": "directory",
    "connector": null,
    "data": "{}",
    "extra": "",
    "search": null,
    "last_modified": "2025-10-16T15:35:30.626",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "a8280168-7cf2-40b1-bc5d-733014ae6ba9",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 165561,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "DIMP: 2 Criar tbls Funcionários",
    "description": "",
    "uuid": "14525828-334e-5228-ac21-be7b38b46b1c",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 165561, \"uuid\": \"14525828-334e-5228-ac21-be7b38b46b1c\", \"name\": \"DIMP: 2 Criar tbls Funcion\\u00e1rios\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"14525828-334e-5228-ac21-be7b38b46b1c\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"68a1422d-6a96-0579-9a2d-481928af9b2b\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 519, \"column\": 53}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": false, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"savedQueries\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ========================================================================\\r\\n-- PROJETO DIMP - AN\\u00c1LISE DE FUNCION\\u00c1RIOS E V\\u00cdNCULOS EMPREGAT\\u00cdCIOS\\r\\n-- Objetivo: Identificar funcion\\u00e1rios recebendo pagamentos acima do sal\\u00e1rio\\r\\n-- Database: teste.dimp_func_*\\r\\n-- Per\\u00edodo: 2024-2025\\r\\n-- ========================================================================\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 1: Arquivos DIMP V\\u00e1lidos (Filtro Base)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_arquivos_validos;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_arquivos_validos AS\\r\\nSELECT DISTINCT\\r\\n    id_arquivo_dimp,\\r\\n    aar_sit_arquivo,\\r\\n    aar_sit_processamento,\\r\\n    aar_id_bloqueio\\r\\nFROM usr_sat_admcc.acc_arquivo\\r\\nWHERE aar_sit_arquivo = 1 -- Arquivo n\\u00e3o foi substitu\\u00eddo\\r\\n    AND aar_sit_processamento = 5 -- arquivo processado com sucesso\\r\\n    AND aar_id_bloqueio IS NULL; -- Arquivo n\\u00e3o foi bloqueado\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 2: Opera\\u00e7\\u00f5es DIMP Filtradas (Base Comum)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_operacoes_base;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_operacoes_base AS\\r\\nSELECT \\r\\n    TRIM(OP.aop_nu_cnpjmf) AS identificador,\\r\\n    OP.aop_dt_operacao, \\r\\n    OP.aop_vl_operacao, \\r\\n    OP.aop_id_nat_jur, \\r\\n    OP.aop_tp_natureza,\\r\\n    OP.aop_ind_cancelamento,\\r\\n    NIV.apa_tp_nivel,\\r\\n    CASE \\r\\n        WHEN LENGTH(TRIM(OP.aop_nu_cnpjmf)) = 14 THEN 'CNPJ'\\r\\n        WHEN LENGTH(TRIM(OP.aop_nu_cnpjmf)) = 11 THEN 'CPF'\\r\\n        ELSE 'INVALIDO'\\r\\n    END AS tipo_identificador\\r\\nFROM usr_sat_admcc.acc_r65_operacao AS OP\\r\\nJOIN usr_sat_admcc.acc_pagamentonivel AS NIV\\r\\n    ON OP.aop_nu_seq = NIV.apa_id_pagamento\\r\\nJOIN teste.dimp_func_arquivos_validos AS ARQ\\r\\n    ON OP.id_arquivo_dimp = ARQ.id_arquivo_dimp\\r\\nWHERE OP.aop_dt_operacao >= DATE '2025-01-01'\\r\\n    AND OP.aop_dt_operacao <= DATE '2025-08-31'\\r\\n    AND OP.aop_tp_natureza IN (1,2,6,7) -- cart\\u00e3o cr\\u00e9dito, d\\u00e9bito, pix e voucher\\r\\n    AND OP.aop_ind_cancelamento = 0; -- apenas opera\\u00e7\\u00f5es n\\u00e3o canceladas\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 3: Pagamentos por CNPJ (N\\u00edvel 1)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_pagto_cnpj;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_pagto_cnpj AS\\r\\nSELECT\\r\\n    identificador AS nu_cnpj,\\r\\n    SUM(aop_vl_operacao) AS valor_cnpj,\\r\\n    COUNT(*) AS qtd_transacoes_cnpj,\\r\\n    MIN(aop_dt_operacao) AS dt_primeira_operacao,\\r\\n    MAX(aop_dt_operacao) AS dt_ultima_operacao\\r\\nFROM teste.dimp_func_operacoes_base\\r\\nWHERE apa_tp_nivel = 1\\r\\n    AND tipo_identificador = 'CNPJ'\\r\\nGROUP BY identificador;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 4: Pagamentos por CPF (N\\u00edvel 1)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_pagto_cpf;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_pagto_cpf AS\\r\\nSELECT\\r\\n    identificador AS nu_cpf,\\r\\n    SUM(aop_vl_operacao) AS valor_cpf,\\r\\n    COUNT(*) AS qtd_transacoes_cpf,\\r\\n    MIN(aop_dt_operacao) AS dt_primeira_operacao,\\r\\n    MAX(aop_dt_operacao) AS dt_ultima_operacao\\r\\nFROM teste.dimp_func_operacoes_base\\r\\nWHERE apa_tp_nivel = 1\\r\\n    AND tipo_identificador = 'CPF'\\r\\nGROUP BY identificador;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 5: Pagamentos CPF via PIX (N\\u00edvel 2)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_pagto_cpf_pix;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_pagto_cpf_pix AS\\r\\nSELECT\\r\\n    identificador AS nu_cpf,\\r\\n    SUM(aop_vl_operacao) AS valor_cpf_pix,\\r\\n    COUNT(*) AS qtd_transacoes_pix,\\r\\n    MIN(aop_dt_operacao) AS dt_primeira_operacao_pix,\\r\\n    MAX(aop_dt_operacao) AS dt_ultima_operacao_pix\\r\\nFROM teste.dimp_func_operacoes_base\\r\\nWHERE apa_tp_nivel = 2\\r\\n    AND tipo_identificador = 'CPF'\\r\\n    AND (aop_id_nat_jur = 0 OR aop_id_nat_jur IS NULL) -- origem \\u00e9 CPF\\r\\nGROUP BY identificador;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 6: Pagamentos CPF no \\u00daltimo M\\u00eas (Flag Recente)\\r\\n-- SIMPLIFICADO: Cria tabela vazia para n\\u00e3o travar o processo\\r\\n-- NOTA: Esta m\\u00e9trica \\u00e9 opcional. Se necess\\u00e1rio, pode ser calculada depois.\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_pagto_cpf_recente;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_pagto_cpf_recente AS\\r\\nSELECT\\r\\n    nu_cpf,\\r\\n    CAST(0 AS DOUBLE) AS valor_cpf_ultimo_mes,\\r\\n    0 AS qtd_transacoes_ultimo_mes\\r\\nFROM teste.dimp_func_pagto_cpf\\r\\nWHERE 1=0; -- Cria estrutura vazia\\r\\n\\r\\n-- ALTERNATIVA R\\u00c1PIDA: Se quiser popular depois, use:\\r\\n-- INSERT INTO teste.dimp_func_pagto_cpf_recente\\r\\n-- SELECT cpf_socio, SUM(vl_total), COUNT(*)\\r\\n-- FROM teste.dimp_pagamentos_cpf\\r\\n-- WHERE referencia = 202508\\r\\n-- GROUP BY cpf_socio;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 7: V\\u00ednculos Empregat\\u00edcios RAIS/CAGED\\r\\n-- ATUALIZADO: Filtros adicionais para maior confiabilidade\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_vinculos;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_vinculos AS\\r\\nSELECT \\r\\n    TRIM(cnpj_cei) AS cnpj,\\r\\n    TRIM(cpf) AS cpf,\\r\\n    MAX(tamanho_estabelecimento) AS tamanho_estabelecimento,\\r\\n    MAX(vl_salario_contratual) AS vl_salario_contratual,\\r\\n    MAX(cbo_ocupacao_2002) AS ocupacao,\\r\\n    COUNT(*) AS qtd_vinculos\\r\\nFROM rais_caged.vw_rais_vinculos\\r\\nWHERE vinculo_ativo_31_12 = 1\\r\\n    AND ano_arquivo >= 2023 -- Arquivos muito antigos n\\u00e3o s\\u00e3o confi\\u00e1veis quanto \\u00e0 situa\\u00e7\\u00e3o do v\\u00ednculo\\r\\n    AND TRIM(mes_desligamento) = 'ignorado'\\r\\nGROUP BY TRIM(cnpj_cei), TRIM(cpf);\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 8: Faturamento Declarado PGDAS-D\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_pgdasd;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_pgdasd AS\\r\\nSELECT \\r\\n    TRIM(nu_cnpj) AS nu_cnpj,\\r\\n    SUM(vl_rec_bruta_estab) AS receita_pgdasd,\\r\\n    COUNT(DISTINCT nu_per_ref) AS qtd_meses_declarados\\r\\nFROM usr_sat_ods.vw_sna_pgdasd_estabelecimento\\r\\nWHERE nu_per_ref BETWEEN 202501 AND 202508\\r\\nGROUP BY TRIM(nu_cnpj);\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 9: Faturamento Declarado DIME\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_dime;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_dime AS\\r\\nSELECT \\r\\n    TRIM(nu_cnpj) AS nu_cnpj,\\r\\n    SUM(vl_receita_bruta) AS receita_dime,\\r\\n    COUNT(DISTINCT nu_per_ref) AS qtd_meses_declarados\\r\\nFROM usr_sat_ods.vw_ods_decl_dime\\r\\nWHERE nu_per_ref BETWEEN 202501 AND 202508\\r\\nGROUP BY TRIM(nu_cnpj);\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 10: Situa\\u00e7\\u00f5es Especiais Cadastrais (Venda n\\u00e3o presencial)\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_sit_especial;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_sit_especial AS\\r\\nSELECT DISTINCT \\r\\n    TRIM(gru_rge_ruc) AS nu_ie\\r\\nFROM usr_sat_cadastro.gen_ruc\\r\\nWHERE gru_cod_atrib = 12  -- c\\u00f3digo 12 \\u00e9 situa\\u00e7\\u00e3o especial\\r\\n    AND TRIM(gru_valor) IN ('22','23'); -- venda n\\u00e3o presencial\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 11: Formas de Atua\\u00e7\\u00e3o Remota\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_remotos;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_remotos AS\\r\\nSELECT \\r\\n    TRIM(gru_rge_ruc) AS nu_ie\\r\\nFROM usr_sat_cadastro.gen_ruc\\r\\nWHERE gru_cod_atrib = 7 -- forma de atua\\u00e7\\u00e3o\\r\\nGROUP BY TRIM(gru_rge_ruc)\\r\\nHAVING COUNT(DISTINCT CASE WHEN gru_valor IN ('3','4','5','6','7','8') THEN 1 END) > 0 -- tem atua\\u00e7\\u00e3o remota\\r\\n    AND COUNT(DISTINCT CASE WHEN gru_valor NOT IN ('3','4','5','6','7','8') THEN 1 END) = 0; -- n\\u00e3o tem estabelecimento fixo\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 12: Tabela Consolidada - Funcion\\u00e1rios x Pagamentos\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_consolidado;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_consolidado AS\\r\\nWITH \\r\\n-- Contagens de relacionamento (sem window functions com DISTINCT)\\r\\ncontagens_cpf AS (\\r\\n    SELECT\\r\\n        cpf,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_cnpjs_do_cpf\\r\\n    FROM teste.dimp_func_vinculos\\r\\n    GROUP BY cpf\\r\\n),\\r\\ncontagens_cnpj AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT cpf) AS qtd_cpfs_do_cnpj\\r\\n    FROM teste.dimp_func_vinculos\\r\\n    GROUP BY cnpj\\r\\n),\\r\\n-- Valores ajustados proporcionalmente\\r\\nvalores_ajustados AS (\\r\\n    SELECT\\r\\n        V.cnpj,\\r\\n        V.cpf,\\r\\n        CCPF.qtd_cnpjs_do_cpf,\\r\\n        CCNPJ.qtd_cpfs_do_cnpj,\\r\\n        CASE \\r\\n            WHEN CCNPJ.qtd_cpfs_do_cnpj = 0 THEN 0\\r\\n            ELSE CAST(COALESCE(PCNPJ.valor_cnpj, 0) AS DOUBLE) / CAST(CCNPJ.qtd_cpfs_do_cnpj AS DOUBLE)\\r\\n        END AS valor_cnpj_ajustado,\\r\\n        COALESCE(PCPF.valor_cpf, 0) AS valor_cpf,\\r\\n        COALESCE(PPIX.valor_cpf_pix, 0) AS valor_cpf_pix,\\r\\n        COALESCE(PREC.valor_cpf_ultimo_mes, 0) AS valor_cpf_ultimo_mes,\\r\\n        CASE \\r\\n            WHEN CCNPJ.qtd_cpfs_do_cnpj = 0 THEN 0\\r\\n            ELSE (CAST(COALESCE(PGD.receita_pgdasd, 0) AS DOUBLE) + \\r\\n                  CAST(COALESCE(DIM.receita_dime, 0) AS DOUBLE)) / \\r\\n                 CAST(CCNPJ.qtd_cpfs_do_cnpj AS DOUBLE)\\r\\n        END AS faturamento_declarado_ajustado,\\r\\n        PGD.receita_pgdasd,\\r\\n        DIM.receita_dime\\r\\n    FROM teste.dimp_func_vinculos V\\r\\n    LEFT JOIN contagens_cpf CCPF ON V.cpf = CCPF.cpf\\r\\n    LEFT JOIN contagens_cnpj CCNPJ ON V.cnpj = CCNPJ.cnpj\\r\\n    LEFT JOIN teste.dimp_func_pagto_cnpj PCNPJ ON V.cnpj = PCNPJ.nu_cnpj\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf PCPF ON V.cpf = PCPF.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf_pix PPIX ON V.cpf = PPIX.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf_recente PREC ON V.cpf = PREC.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pgdasd PGD ON V.cnpj = PGD.nu_cnpj\\r\\n    LEFT JOIN teste.dimp_func_dime DIM ON V.cnpj = DIM.nu_cnpj\\r\\n)\\r\\nSELECT\\r\\n    CAD.nu_cnpj_grupo AS raiz_cnpj,\\r\\n    V.cnpj,\\r\\n    CAD.nu_ie,\\r\\n    CAD.nm_razao_social,\\r\\n    CAD.nm_fantasia,\\r\\n    V.cpf AS cpf_funcionario,\\r\\n    V.ocupacao,\\r\\n    VA.valor_cnpj_ajustado,\\r\\n    VA.valor_cpf,\\r\\n    VA.valor_cpf_pix,\\r\\n    VA.valor_cnpj_ajustado + VA.valor_cpf AS dimp_total_funcionario,\\r\\n    VA.valor_cpf_ultimo_mes,\\r\\n    CASE WHEN VA.valor_cpf_ultimo_mes > 0 THEN 'SIM' ELSE 'NAO' END AS flag_recente,\\r\\n    CASE WHEN VA.valor_cpf > 0 THEN 'SIM' ELSE 'NAO' END AS flag_pos,\\r\\n    VA.qtd_cnpjs_do_cpf,\\r\\n    VA.qtd_cpfs_do_cnpj,\\r\\n    V.tamanho_estabelecimento,\\r\\n    V.vl_salario_contratual AS salario_contratual,\\r\\n    CASE \\r\\n        WHEN COALESCE(V.vl_salario_contratual, 0) < 1518 THEN 0 -- Se sal\\u00e1rio abaixo do m\\u00ednimo, n\\u00e3o calcula\\r\\n        ELSE (VA.valor_cpf + VA.valor_cpf_pix) / V.vl_salario_contratual\\r\\n    END AS multiplicador_salario,\\r\\n    VA.faturamento_declarado_ajustado,\\r\\n    VA.valor_cnpj_ajustado + VA.valor_cpf + VA.valor_cpf_pix - VA.faturamento_declarado_ajustado AS diferenca_dimp_faturamento,\\r\\n    CAD.nm_reg_apuracao AS regime_tributario,\\r\\n    CAD.nm_gerfe AS gerencia,\\r\\n    CAD.nm_munic AS municipio,\\r\\n    CAD.nm_ges AS ges,\\r\\n    CAD.dt_inclusao_cad AS dt_inclusao_cadastro,\\r\\n    CAD.cd_cnae AS cnae_principal,\\r\\n    CAD.de_cnae AS descricao_cnae,\\r\\n    CAD.nm_logradouro AS logradouro,\\r\\n    CAD.nu_logradouro AS numero,\\r\\n    CAD.tx_complemento AS complemento,\\r\\n    CAD.tx_referencia AS referencia,\\r\\n    CAD.nm_bairro AS bairro,\\r\\n    CAD.cd_cep AS cep\\r\\nFROM teste.dimp_func_vinculos V\\r\\nINNER JOIN valores_ajustados VA \\r\\n    ON V.cnpj = VA.cnpj AND V.cpf = VA.cpf\\r\\nINNER JOIN usr_sat_ods.vw_ods_contrib CAD \\r\\n    ON TRIM(CAD.nu_cnpj) = V.cnpj\\r\\nWHERE (VA.valor_cpf IS NOT NULL OR VA.valor_cpf_pix IS NOT NULL)\\r\\n    AND CAD.cd_sit_cadastral = 1 -- apenas IE ativa\\r\\n    AND (LEFT(CAST(CAD.cd_cnae AS STRING), 2) = '47' \\r\\n         OR CAD.cd_cnae IN (4530703, 4530705, 4541206, 5611201, 5611203, 5611204, 5611205))\\r\\n    AND VA.valor_cnpj_ajustado + VA.valor_cpf + VA.valor_cpf_pix - VA.faturamento_declarado_ajustado > 0\\r\\n    AND CAD.nu_ie_rge_ruc NOT IN (SELECT nu_ie FROM teste.dimp_func_sit_especial)\\r\\n    AND CAD.nu_ie_rge_ruc NOT IN (SELECT nu_ie FROM teste.dimp_func_remotos);\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 13: M\\u00e9tricas e Scores de Risco - Funcion\\u00e1rios\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_metricas;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_metricas AS\\r\\nWITH\\r\\n-- Estat\\u00edsticas por CNAE\\r\\nestatisticas_cnae AS (\\r\\n    SELECT\\r\\n        cnae_principal,\\r\\n        AVG(multiplicador_salario) AS media_mult_salario_cnae,\\r\\n        STDDEV(multiplicador_salario) AS desvio_mult_salario_cnae,\\r\\n        AVG(dimp_total_funcionario / NULLIF(salario_contratual, 0)) AS media_ratio_dimp_salario\\r\\n    FROM teste.dimp_func_consolidado\\r\\n    WHERE salario_contratual > 0\\r\\n    GROUP BY cnae_principal\\r\\n)\\r\\nSELECT\\r\\n    C.*,\\r\\n    E.media_mult_salario_cnae,\\r\\n    E.desvio_mult_salario_cnae,\\r\\n    E.media_ratio_dimp_salario,\\r\\n    -- Score 1: Multiplicador de Sal\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN C.multiplicador_salario >= 20 THEN 100\\r\\n        WHEN C.multiplicador_salario >= 10 THEN 80\\r\\n        WHEN C.multiplicador_salario >= 5 THEN 60\\r\\n        WHEN C.multiplicador_salario >= 3 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_multiplicador,\\r\\n    -- Score 2: Volume absoluto recebido pelo funcion\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN C.dimp_total_funcionario >= 500000 THEN 100\\r\\n        WHEN C.dimp_total_funcionario >= 200000 THEN 80\\r\\n        WHEN C.dimp_total_funcionario >= 100000 THEN 60\\r\\n        WHEN C.dimp_total_funcionario >= 50000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_volume_funcionario,\\r\\n    -- Score 3: Diferen\\u00e7a DIMP x Faturamento (0-100)\\r\\n    CASE \\r\\n        WHEN C.diferenca_dimp_faturamento >= 1000000 THEN 100\\r\\n        WHEN C.diferenca_dimp_faturamento >= 500000 THEN 80\\r\\n        WHEN C.diferenca_dimp_faturamento >= 200000 THEN 60\\r\\n        WHEN C.diferenca_dimp_faturamento >= 100000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_diferenca,\\r\\n    -- Score 4: Funcion\\u00e1rio em m\\u00faltiplas empresas (0-100)\\r\\n    CASE \\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 5 THEN 100\\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 3 THEN 70\\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 2 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_multiplas_empresas,\\r\\n    -- Score 5: Atividade recente (0-100)\\r\\n    CASE \\r\\n        WHEN C.flag_recente = 'SIM' AND C.valor_cpf_ultimo_mes >= 50000 THEN 100\\r\\n        WHEN C.flag_recente = 'SIM' AND C.valor_cpf_ultimo_mes >= 20000 THEN 70\\r\\n        WHEN C.flag_recente = 'SIM' THEN 40\\r\\n        ELSE 10\\r\\n    END AS score_atividade_recente\\r\\nFROM teste.dimp_func_consolidado C\\r\\nLEFT JOIN estatisticas_cnae E ON C.cnae_principal = E.cnae_principal;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 14: Score Final de Risco - Funcion\\u00e1rios\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_score_final;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_score_final AS\\r\\nSELECT\\r\\n    M.*,\\r\\n    ROUND(\\r\\n        (M.score_multiplicador * 0.35) + \\r\\n        (M.score_volume_funcionario * 0.25) + \\r\\n        (M.score_diferenca * 0.20) + \\r\\n        (M.score_multiplas_empresas * 0.10) + \\r\\n        (M.score_atividade_recente * 0.10),\\r\\n    2) AS score_risco_final,\\r\\n    CASE \\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 80 THEN 'ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 60 THEN 'M\\u00c9DIO-ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco\\r\\nFROM teste.dimp_func_metricas M;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 15: View - Top Funcion\\u00e1rios Suspeitos\\r\\n-- ========================================================================\\r\\nDROP VIEW IF EXISTS teste.dimp_func_top_suspeitos;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE VIEW teste.dimp_func_top_suspeitos AS\\r\\nSELECT\\r\\n    cnpj,\\r\\n    nm_razao_social,\\r\\n    cpf_funcionario,\\r\\n    ocupacao,\\r\\n    salario_contratual,\\r\\n    dimp_total_funcionario,\\r\\n    multiplicador_salario,\\r\\n    diferenca_dimp_faturamento,\\r\\n    qtd_cnpjs_do_cpf,\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    regime_tributario,\\r\\n    municipio,\\r\\n    cnae_principal,\\r\\n    descricao_cnae\\r\\nFROM teste.dimp_func_score_final\\r\\nWHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND multiplicador_salario >= 3\\r\\nORDER BY score_risco_final DESC;\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 16: An\\u00e1lise de Rede - Funcion\\u00e1rios em M\\u00faltiplas Empresas\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_rede_multiplas;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE teste.dimp_func_rede_multiplas AS\\r\\nWITH func_multi AS (\\r\\n    SELECT\\r\\n        cpf_funcionario,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas_vinculadas,\\r\\n        SUM(dimp_total_funcionario) AS total_recebido_todas_empresas,\\r\\n        SUM(salario_contratual) AS total_salarios,\\r\\n        AVG(multiplicador_salario) AS media_multiplicador,\\r\\n        GROUP_CONCAT(DISTINCT cnpj, ', ') AS cnpjs_vinculados\\r\\n    FROM teste.dimp_func_consolidado\\r\\n    GROUP BY cpf_funcionario\\r\\n    HAVING COUNT(DISTINCT cnpj) >= 2\\r\\n)\\r\\nSELECT\\r\\n    F.*,\\r\\n    CASE \\r\\n        WHEN F.qtd_empresas_vinculadas >= 10 THEN 'MUITO ALTO'\\r\\n        WHEN F.qtd_empresas_vinculadas >= 5 THEN 'ALTO'\\r\\n        WHEN F.qtd_empresas_vinculadas >= 3 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS nivel_dispersao\\r\\nFROM func_multi F\\r\\nORDER BY F.qtd_empresas_vinculadas DESC, F.total_recebido_todas_empresas DESC;\\r\\n\\r\\n-- ========================================================================\\r\\n-- QUERIES DE VERIFICA\\u00c7\\u00c3O E ESTAT\\u00cdSTICAS\\r\\n-- ========================================================================\\r\\n\\r\\n-- Estat\\u00edsticas Gerais\\r\\nSELECT \\r\\n    COUNT(DISTINCT cnpj) AS total_empresas_analisadas,\\r\\n    COUNT(DISTINCT cpf_funcionario) AS total_funcionarios_suspeitos,\\r\\n    SUM(CASE WHEN multiplicador_salario >= 10 THEN 1 ELSE 0 END) AS func_mult_maior_10x,\\r\\n    SUM(CASE WHEN classificacao_risco = 'ALTO' THEN 1 ELSE 0 END) AS casos_risco_alto,\\r\\n    ROUND(AVG(multiplicador_salario), 2) AS media_multiplicador,\\r\\n    ROUND(AVG(dimp_total_funcionario), 2) AS media_valor_funcionario\\r\\nFROM teste.dimp_func_score_final;\\r\\n\\r\\n-- Top 50 Casos Cr\\u00edticos\\r\\nSELECT * FROM teste.dimp_func_top_suspeitos LIMIT 50;\", \"statementsList\": [\"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_remotos AS\\r\\nSELECT \\r\\n    TRIM(gru_rge_ruc) AS nu_ie\\r\\nFROM usr_sat_cadastro.gen_ruc\\r\\nWHERE gru_cod_atrib = 7 -- forma de atua\\u00e7\\u00e3o\\r\\nGROUP BY TRIM(gru_rge_ruc)\\r\\nHAVING COUNT(DISTINCT CASE WHEN gru_valor IN ('3','4','5','6','7','8') THEN 1 END) > 0 -- tem atua\\u00e7\\u00e3o remota\\r\\n    AND COUNT(DISTINCT CASE WHEN gru_valor NOT IN ('3','4','5','6','7','8') THEN 1 END) = 0;\", \" -- n\\u00e3o tem estabelecimento fixo\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 12: Tabela Consolidada - Funcion\\u00e1rios x Pagamentos\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_consolidado;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_consolidado AS\\r\\nWITH \\r\\n-- Contagens de relacionamento (sem window functions com DISTINCT)\\r\\ncontagens_cpf AS (\\r\\n    SELECT\\r\\n        cpf,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_cnpjs_do_cpf\\r\\n    FROM teste.dimp_func_vinculos\\r\\n    GROUP BY cpf\\r\\n),\\r\\ncontagens_cnpj AS (\\r\\n    SELECT\\r\\n        cnpj,\\r\\n        COUNT(DISTINCT cpf) AS qtd_cpfs_do_cnpj\\r\\n    FROM teste.dimp_func_vinculos\\r\\n    GROUP BY cnpj\\r\\n),\\r\\n-- Valores ajustados proporcionalmente\\r\\nvalores_ajustados AS (\\r\\n    SELECT\\r\\n        V.cnpj,\\r\\n        V.cpf,\\r\\n        CCPF.qtd_cnpjs_do_cpf,\\r\\n        CCNPJ.qtd_cpfs_do_cnpj,\\r\\n        CASE \\r\\n            WHEN CCNPJ.qtd_cpfs_do_cnpj = 0 THEN 0\\r\\n            ELSE CAST(COALESCE(PCNPJ.valor_cnpj, 0) AS DOUBLE) / CAST(CCNPJ.qtd_cpfs_do_cnpj AS DOUBLE)\\r\\n        END AS valor_cnpj_ajustado,\\r\\n        COALESCE(PCPF.valor_cpf, 0) AS valor_cpf,\\r\\n        COALESCE(PPIX.valor_cpf_pix, 0) AS valor_cpf_pix,\\r\\n        COALESCE(PREC.valor_cpf_ultimo_mes, 0) AS valor_cpf_ultimo_mes,\\r\\n        CASE \\r\\n            WHEN CCNPJ.qtd_cpfs_do_cnpj = 0 THEN 0\\r\\n            ELSE (CAST(COALESCE(PGD.receita_pgdasd, 0) AS DOUBLE) + \\r\\n                  CAST(COALESCE(DIM.receita_dime, 0) AS DOUBLE)) / \\r\\n                 CAST(CCNPJ.qtd_cpfs_do_cnpj AS DOUBLE)\\r\\n        END AS faturamento_declarado_ajustado,\\r\\n        PGD.receita_pgdasd,\\r\\n        DIM.receita_dime\\r\\n    FROM teste.dimp_func_vinculos V\\r\\n    LEFT JOIN contagens_cpf CCPF ON V.cpf = CCPF.cpf\\r\\n    LEFT JOIN contagens_cnpj CCNPJ ON V.cnpj = CCNPJ.cnpj\\r\\n    LEFT JOIN teste.dimp_func_pagto_cnpj PCNPJ ON V.cnpj = PCNPJ.nu_cnpj\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf PCPF ON V.cpf = PCPF.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf_pix PPIX ON V.cpf = PPIX.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pagto_cpf_recente PREC ON V.cpf = PREC.nu_cpf\\r\\n    LEFT JOIN teste.dimp_func_pgdasd PGD ON V.cnpj = PGD.nu_cnpj\\r\\n    LEFT JOIN teste.dimp_func_dime DIM ON V.cnpj = DIM.nu_cnpj\\r\\n)\\r\\nSELECT\\r\\n    CAD.nu_cnpj_grupo AS raiz_cnpj,\\r\\n    V.cnpj,\\r\\n    CAD.nu_ie,\\r\\n    CAD.nm_razao_social,\\r\\n    CAD.nm_fantasia,\\r\\n    V.cpf AS cpf_funcionario,\\r\\n    V.ocupacao,\\r\\n    VA.valor_cnpj_ajustado,\\r\\n    VA.valor_cpf,\\r\\n    VA.valor_cpf_pix,\\r\\n    VA.valor_cnpj_ajustado + VA.valor_cpf AS dimp_total_funcionario,\\r\\n    VA.valor_cpf_ultimo_mes,\\r\\n    CASE WHEN VA.valor_cpf_ultimo_mes > 0 THEN 'SIM' ELSE 'NAO' END AS flag_recente,\\r\\n    CASE WHEN VA.valor_cpf > 0 THEN 'SIM' ELSE 'NAO' END AS flag_pos,\\r\\n    VA.qtd_cnpjs_do_cpf,\\r\\n    VA.qtd_cpfs_do_cnpj,\\r\\n    V.tamanho_estabelecimento,\\r\\n    V.vl_salario_contratual AS salario_contratual,\\r\\n    CASE \\r\\n        WHEN COALESCE(V.vl_salario_contratual, 0) < 1518 THEN 0 -- Se sal\\u00e1rio abaixo do m\\u00ednimo, n\\u00e3o calcula\\r\\n        ELSE (VA.valor_cpf + VA.valor_cpf_pix) / V.vl_salario_contratual\\r\\n    END AS multiplicador_salario,\\r\\n    VA.faturamento_declarado_ajustado,\\r\\n    VA.valor_cnpj_ajustado + VA.valor_cpf + VA.valor_cpf_pix - VA.faturamento_declarado_ajustado AS diferenca_dimp_faturamento,\\r\\n    CAD.nm_reg_apuracao AS regime_tributario,\\r\\n    CAD.nm_gerfe AS gerencia,\\r\\n    CAD.nm_munic AS municipio,\\r\\n    CAD.nm_ges AS ges,\\r\\n    CAD.dt_inclusao_cad AS dt_inclusao_cadastro,\\r\\n    CAD.cd_cnae AS cnae_principal,\\r\\n    CAD.de_cnae AS descricao_cnae,\\r\\n    CAD.nm_logradouro AS logradouro,\\r\\n    CAD.nu_logradouro AS numero,\\r\\n    CAD.tx_complemento AS complemento,\\r\\n    CAD.tx_referencia AS referencia,\\r\\n    CAD.nm_bairro AS bairro,\\r\\n    CAD.cd_cep AS cep\\r\\nFROM teste.dimp_func_vinculos V\\r\\nINNER JOIN valores_ajustados VA \\r\\n    ON V.cnpj = VA.cnpj AND V.cpf = VA.cpf\\r\\nINNER JOIN usr_sat_ods.vw_ods_contrib CAD \\r\\n    ON TRIM(CAD.nu_cnpj) = V.cnpj\\r\\nWHERE (VA.valor_cpf IS NOT NULL OR VA.valor_cpf_pix IS NOT NULL)\\r\\n    AND CAD.cd_sit_cadastral = 1 -- apenas IE ativa\\r\\n    AND (LEFT(CAST(CAD.cd_cnae AS STRING), 2) = '47' \\r\\n         OR CAD.cd_cnae IN (4530703, 4530705, 4541206, 5611201, 5611203, 5611204, 5611205))\\r\\n    AND VA.valor_cnpj_ajustado + VA.valor_cpf + VA.valor_cpf_pix - VA.faturamento_declarado_ajustado > 0\\r\\n    AND CAD.nu_ie_rge_ruc NOT IN (SELECT nu_ie FROM teste.dimp_func_sit_especial)\\r\\n    AND CAD.nu_ie_rge_ruc NOT IN (SELECT nu_ie FROM teste.dimp_func_remotos);\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 13: M\\u00e9tricas e Scores de Risco - Funcion\\u00e1rios\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_metricas;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_metricas AS\\r\\nWITH\\r\\n-- Estat\\u00edsticas por CNAE\\r\\nestatisticas_cnae AS (\\r\\n    SELECT\\r\\n        cnae_principal,\\r\\n        AVG(multiplicador_salario) AS media_mult_salario_cnae,\\r\\n        STDDEV(multiplicador_salario) AS desvio_mult_salario_cnae,\\r\\n        AVG(dimp_total_funcionario / NULLIF(salario_contratual, 0)) AS media_ratio_dimp_salario\\r\\n    FROM teste.dimp_func_consolidado\\r\\n    WHERE salario_contratual > 0\\r\\n    GROUP BY cnae_principal\\r\\n)\\r\\nSELECT\\r\\n    C.*,\\r\\n    E.media_mult_salario_cnae,\\r\\n    E.desvio_mult_salario_cnae,\\r\\n    E.media_ratio_dimp_salario,\\r\\n    -- Score 1: Multiplicador de Sal\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN C.multiplicador_salario >= 20 THEN 100\\r\\n        WHEN C.multiplicador_salario >= 10 THEN 80\\r\\n        WHEN C.multiplicador_salario >= 5 THEN 60\\r\\n        WHEN C.multiplicador_salario >= 3 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_multiplicador,\\r\\n    -- Score 2: Volume absoluto recebido pelo funcion\\u00e1rio (0-100)\\r\\n    CASE \\r\\n        WHEN C.dimp_total_funcionario >= 500000 THEN 100\\r\\n        WHEN C.dimp_total_funcionario >= 200000 THEN 80\\r\\n        WHEN C.dimp_total_funcionario >= 100000 THEN 60\\r\\n        WHEN C.dimp_total_funcionario >= 50000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_volume_funcionario,\\r\\n    -- Score 3: Diferen\\u00e7a DIMP x Faturamento (0-100)\\r\\n    CASE \\r\\n        WHEN C.diferenca_dimp_faturamento >= 1000000 THEN 100\\r\\n        WHEN C.diferenca_dimp_faturamento >= 500000 THEN 80\\r\\n        WHEN C.diferenca_dimp_faturamento >= 200000 THEN 60\\r\\n        WHEN C.diferenca_dimp_faturamento >= 100000 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_diferenca,\\r\\n    -- Score 4: Funcion\\u00e1rio em m\\u00faltiplas empresas (0-100)\\r\\n    CASE \\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 5 THEN 100\\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 3 THEN 70\\r\\n        WHEN C.qtd_cnpjs_do_cpf >= 2 THEN 40\\r\\n        ELSE 20\\r\\n    END AS score_multiplas_empresas,\\r\\n    -- Score 5: Atividade recente (0-100)\\r\\n    CASE \\r\\n        WHEN C.flag_recente = 'SIM' AND C.valor_cpf_ultimo_mes >= 50000 THEN 100\\r\\n        WHEN C.flag_recente = 'SIM' AND C.valor_cpf_ultimo_mes >= 20000 THEN 70\\r\\n        WHEN C.flag_recente = 'SIM' THEN 40\\r\\n        ELSE 10\\r\\n    END AS score_atividade_recente\\r\\nFROM teste.dimp_func_consolidado C\\r\\nLEFT JOIN estatisticas_cnae E ON C.cnae_principal = E.cnae_principal;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 14: Score Final de Risco - Funcion\\u00e1rios\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_score_final;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_score_final AS\\r\\nSELECT\\r\\n    M.*,\\r\\n    ROUND(\\r\\n        (M.score_multiplicador * 0.35) + \\r\\n        (M.score_volume_funcionario * 0.25) + \\r\\n        (M.score_diferenca * 0.20) + \\r\\n        (M.score_multiplas_empresas * 0.10) + \\r\\n        (M.score_atividade_recente * 0.10),\\r\\n    2) AS score_risco_final,\\r\\n    CASE \\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 80 THEN 'ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 60 THEN 'M\\u00c9DIO-ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco\\r\\nFROM teste.dimp_func_metricas M;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 15: View - Top Funcion\\u00e1rios Suspeitos\\r\\n-- ========================================================================\\r\\nDROP VIEW IF EXISTS teste.dimp_func_top_suspeitos;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE VIEW teste.dimp_func_top_suspeitos AS\\r\\nSELECT\\r\\n    cnpj,\\r\\n    nm_razao_social,\\r\\n    cpf_funcionario,\\r\\n    ocupacao,\\r\\n    salario_contratual,\\r\\n    dimp_total_funcionario,\\r\\n    multiplicador_salario,\\r\\n    diferenca_dimp_faturamento,\\r\\n    qtd_cnpjs_do_cpf,\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    regime_tributario,\\r\\n    municipio,\\r\\n    cnae_principal,\\r\\n    descricao_cnae\\r\\nFROM teste.dimp_func_score_final\\r\\nWHERE classificacao_risco IN ('ALTO', 'M\\u00c9DIO-ALTO')\\r\\n    AND multiplicador_salario >= 3\\r\\nORDER BY score_risco_final DESC;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- PARTE 16: An\\u00e1lise de Rede - Funcion\\u00e1rios em M\\u00faltiplas Empresas\\r\\n-- ========================================================================\\r\\nDROP TABLE IF EXISTS teste.dimp_func_rede_multiplas;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_rede_multiplas AS\\r\\nWITH func_multi AS (\\r\\n    SELECT\\r\\n        cpf_funcionario,\\r\\n        COUNT(DISTINCT cnpj) AS qtd_empresas_vinculadas,\\r\\n        SUM(dimp_total_funcionario) AS total_recebido_todas_empresas,\\r\\n        SUM(salario_contratual) AS total_salarios,\\r\\n        AVG(multiplicador_salario) AS media_multiplicador,\\r\\n        GROUP_CONCAT(DISTINCT cnpj, ', ') AS cnpjs_vinculados\\r\\n    FROM teste.dimp_func_consolidado\\r\\n    GROUP BY cpf_funcionario\\r\\n    HAVING COUNT(DISTINCT cnpj) >= 2\\r\\n)\\r\\nSELECT\\r\\n    F.*,\\r\\n    CASE \\r\\n        WHEN F.qtd_empresas_vinculadas >= 10 THEN 'MUITO ALTO'\\r\\n        WHEN F.qtd_empresas_vinculadas >= 5 THEN 'ALTO'\\r\\n        WHEN F.qtd_empresas_vinculadas >= 3 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS nivel_dispersao\\r\\nFROM func_multi F\\r\\nORDER BY F.qtd_empresas_vinculadas DESC, F.total_recebido_todas_empresas DESC;\", \"\\r\\n\\r\\n-- ========================================================================\\r\\n-- QUERIES DE VERIFICA\\u00c7\\u00c3O E ESTAT\\u00cdSTICAS\\r\\n-- ========================================================================\\r\\n\\r\\n-- Estat\\u00edsticas Gerais\\r\\nSELECT \\r\\n    COUNT(DISTINCT cnpj) AS total_empresas_analisadas,\\r\\n    COUNT(DISTINCT cpf_funcionario) AS total_funcionarios_suspeitos,\\r\\n    SUM(CASE WHEN multiplicador_salario >= 10 THEN 1 ELSE 0 END) AS func_mult_maior_10x,\\r\\n    SUM(CASE WHEN classificacao_risco = 'ALTO' THEN 1 ELSE 0 END) AS casos_risco_alto,\\r\\n    ROUND(AVG(multiplicador_salario), 2) AS media_multiplicador,\\r\\n    ROUND(AVG(dimp_total_funcionario), 2) AS media_valor_funcionario\\r\\nFROM teste.dimp_func_score_final;\", \"\\r\\n\\r\\n-- Top 50 Casos Cr\\u00edticos\\r\\nSELECT * FROM teste.dimp_func_top_suspeitos LIMIT 50;\"], \"aceSize\": 100, \"status\": \"ready\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n\\r\\nCREATE TABLE teste.dimp_func_score_final AS\\r\\nSELECT\\r\\n    M.*,\\r\\n    ROUND(\\r\\n        (M.score_multiplicador * 0.35) + \\r\\n        (M.score_volume_funcionario * 0.25) + \\r\\n        (M.score_diferenca * 0.20) + \\r\\n        (M.score_multiplas_empresas * 0.10) + \\r\\n        (M.score_atividade_recente * 0.10),\\r\\n    2) AS score_risco_final,\\r\\n    CASE \\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 80 THEN 'ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 60 THEN 'M\\u00c9DIO-ALTO'\\r\\n        WHEN (M.score_multiplicador * 0.35 + M.score_volume_funcionario * 0.25 + \\r\\n              M.score_diferenca * 0.20 + M.score_multiplas_empresas * 0.10 + \\r\\n              M.score_atividade_recente * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco\\r\\nFROM teste.dimp_func_metricas M;\", \"result\": {\"id\": \"c0cb3c0f-3a36-50be-bf6c-67aa54f4639b\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"+eLwUs19Tsiqdwp2wLUg5Q==\", \"guid\": \"XxCV2wAHRH0AAAAAPAZD/A==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"e5476ce0db5374c8:6e0229600ede9a8c\", \"session_id\": 21728, \"session_type\": \"impala\", \"statement_id\": 16, \"has_more_statements\": false, \"statements_count\": 17, \"previous_statement_hash\": \"88c8a93231258e356147700c47e4b4fcf3488df9401fc26d1025a989\", \"start\": {\"row\": 271, \"column\": 0}, \"end\": {\"row\": 272, \"column\": 52}, \"statement\": \"-- Top 50 Casos Cr\\u00edticos\\nSELECT * FROM teste.dimp_func_top_suspeitos LIMIT 50\"}, \"meta\": [], \"rows\": 50, \"hasMore\": false, \"statement_id\": 16, \"statement_range\": {\"start\": {\"row\": 271, \"column\": 0}, \"end\": {\"row\": 272, \"column\": 52}}, \"statements_count\": 1, \"previous_statement_hash\": null, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": -1, \"filteredMeta\": [], \"fetchedOnce\": false, \"startTime\": \"2025-10-16T20:29:39.959Z\", \"endTime\": \"2025-10-16T20:29:41.314Z\", \"executionTime\": 1355, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 0, \"hasSomeResults\": false}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": -1, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"cnpj\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"dimp_total_funcionario\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"cnpj\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [\"dimp_total_funcionario\"], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": null, \"getLogsTimeout\": null, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760646579702, \"lastAceSelectionRowOffset\": 207, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 78, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 148, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "-- ========================================================================\r\n-- PROJETO DIMP - ANÁLISE DE FUNCIONÁRIOS E VÍNCULOS EMPREGATÍCIOS\r\n-- Objetivo: Identificar funcionários recebendo pagamentos acima do salário\r\n-- Database: teste.dimp_func_*\r\n-- Período: 2024-2025\r\n-- ========================================================================\r\n\r\n-- ========================================================================\r\n-- PARTE 1: Arquivos DIMP Válidos (Filtro Base)\r\n-- ========================================================================\r\nDROP TABLE IF EXISTS teste.dimp_func_arquivos_validos;\r\nSET REQUEST_POOL = 'medium';\r\n\r\nCREATE TABLE teste.dimp_func_arquivos_validos AS\r\nSELECT DISTINCT\r\n    id_arquivo_dimp,\r\n    aar_sit_arquivo,\r\n    aar_sit_processamento,\r\n    aar_id_bloqueio\r\nFROM usr_sat_admcc.acc_arquivo\r\nWHERE aar_sit_arquivo = 1 -- Arquivo não foi substituído\r\n    AND aar_sit_processamento = 5 -- arquivo processado com sucesso\r\n    AND aar_id_bloqueio IS NULL; -- Arquivo não foi bloqueado\r\n\r\n-- ========================================================================\r\n-- PARTE 2: Operações DIMP Filtradas (Base Comum)\r\n-- ========================================================================\r\nDROP TABLE IF EXISTS teste.dimp_func_operacoes_base;\r\nSET REQUEST_POOL = 'medium';\r\n\r\nCREATE TABLE teste.dimp_func_operacoes_base AS\r\nSELECT \r\n    TRIM(OP.aop_nu_cnpjmf) AS identificador,\r\n    OP.aop_dt_operacao, \r\n    OP.aop_vl_operacao, \r\n    OP.aop_id_nat_jur, \r\n    OP.aop_tp_natureza,\r\n    OP.aop_ind_cancelamento,\r\n    NIV.apa_tp_nivel,\r\n    CASE \r\n        WHEN LENGTH(TRIM(OP.aop_nu_cnpjmf)) = 14 THEN 'CNPJ'\r\n        WHEN LENGTH(TRIM(OP.aop_nu_cnpjmf)) = 11 THEN 'CPF'\r\n        ELSE 'INVALIDO'\r\n    END AS tipo_identificador\r\nFROM usr_sat_admcc.acc_r65_operacao AS OP\r\nJOIN usr_sat_admcc.acc_pagamentonivel AS NIV\r\n    ON OP.aop_nu_seq = NIV.apa_id_pagamento\r\nJOIN teste.dimp_func_arquivos_validos AS ARQ\r\n    ON OP.id_arquivo_dimp = ARQ.id_arquivo_dimp\r\nW",
    "last_modified": "2025-10-17T18:10:34.707",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "da7315d7-ca92-4187-8468-1a3ec4322c51",
      1,
      false
    ],
    "dependencies": []
  }
}
]
